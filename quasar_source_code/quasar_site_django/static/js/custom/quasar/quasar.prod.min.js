'use_strict';const l=console.log;var MANAGER_AUDIO=null;var MANAGER_COOKIES=null;var MANAGER_WORLD=null;var MANAGER_ENTITY=null;var MANAGER_MULTIPLAYER=null;var CURRENT_PLAYER=null;var ENTITY_OWNER=null;var GUI_PAUSED_MENU=null;var GUI_TYPING_INTERFACE=null;const NOT_FOUND=-1;const HALF_PIE=Math.PI/2.0;const PIE=Math.PI;const TWO_PIE=Math.PI*2.0;const WEB_SOCKET_MESSAGE_TYPE_ALL_PLAYERS='|A|';const WEB_SOCKET_MESSAGE_TYPE_CONNECTION='|C|';const WEB_SOCKET_MESSAGE_TYPE_DISCONNECTED='|D|';const WEB_SOCKET_MESSAGE_TYPE_CHAT_MESSAGE='|M|';const WEB_SOCKET_MESSAGE_TYPE_LOOK_AT_UPDATE='|L|';const WEB_SOCKET_MESSAGE_TYPE_POSITION_UPDATE='|P|';const WEB_SOCKET_MESSAGE_TYPE_POSITION_AND_LOOK_AT_UPDATE='|U|';const ENTITY_TYPE_BASE='Entity';const ENTITY_TYPE_TASK='EntityTask';const ENTITY_TYPE_TIME='EntityTime';const ENTITY_TYPE_WALL='EntityWall';const ENTITY_TYPE_OWNER='EntityOwner';const ENTITY_TYPE_TEXT_REMINDER='EntityTextReminder';const ENTITY_TYPE_ALL=[ENTITY_TYPE_BASE,ENTITY_TYPE_TASK,ENTITY_TYPE_TIME,ENTITY_TYPE_WALL,ENTITY_TYPE_OWNER,ENTITY_TYPE_TEXT_REMINDER];const ENTITY_PROPERTY_START_TOKEN='ep_';const ENTITY_DEFAULT_PROPERTY_TYPE=ENTITY_PROPERTY_START_TOKEN+'type';const ENTITY_DEFAULT_PROPERTY_CHILD_IDS=ENTITY_PROPERTY_START_TOKEN+'child_ids';const ENTITY_DEFAULT_PROPERTY_PARENT_IDS=ENTITY_PROPERTY_START_TOKEN+'parent_ids';const ENTITY_DEFAULT_PROPERTY_RELATIVE_ID=ENTITY_PROPERTY_START_TOKEN+'relative_id';const ENTITY_PROPERTY_PUBLIC=ENTITY_PROPERTY_START_TOKEN+'public';const ENTITY_PROPERTY_OWNER=ENTITY_PROPERTY_START_TOKEN+'owner';const ENTITY_PROPERTY_PASSWORD=ENTITY_PROPERTY_START_TOKEN+'password';const ENTITY_PROPERTY_USERNAME=ENTITY_PROPERTY_START_TOKEN+'username';const ENTITY_PROPERTY_EMAIL=ENTITY_PROPERTY_START_TOKEN+'email';const ENTITY_PROPERTY_NAME=ENTITY_PROPERTY_START_TOKEN+'name';const ENTITY_PROPERTY_POSITION=ENTITY_PROPERTY_START_TOKEN+'position';const ENTITY_PROPERTY_LOOK_AT=ENTITY_PROPERTY_START_TOKEN+'look_at';const ENTITY_PROPERTY_COMPLETED=ENTITY_PROPERTY_START_TOKEN+'completed';const ENTITY_PROPERTY_PHONE_NUMBER=ENTITY_PROPERTY_START_TOKEN+'phone_number';const ENTITY_PROPERTY_PHONE_CARRIER=ENTITY_PROPERTY_START_TOKEN+'phone_carrier';const ENTITY_PROPERTY_CREATED_AT_DATE=ENTITY_PROPERTY_START_TOKEN+'created_at_date';const TEMP_PROPERTY_A='Text Contents :';const TEMP_PROPERTY_B='Seconds from now :';const TEMP_PROPERTY_C='Send to :';const POST_URL_DELETE_ENTITY='/delete_entity';const POST_URL_SAVE_ENTITY='/save_entity';const POST_URL_GET_USER_ENTITIES='/get_user_entities';const POST_URL_GET_PUBLIC_ENTITIES='/get_public_entities';const POST_URL_CREATE_ACCOUNT='/create_account';const POST_URL_LOGIN='/login';const POST_URL_ENTITY_MANAGER_STATUS='/server_side_print_entity_manager_status';var GLOBAL_POST_PRINT_ENTITY_MANAGER_STATUS=null;const COOKIE_SHOULD_REMEMBER_USERNAME='should_remember_username';const COOKIE_REMEMBERED_USERNAME='remembered_username';const TYPE_INPUT_PASSWORD=1;const TYPE_INPUT_REGULAR=2;const TYPE_LABEL=3;const TYPE_BUTTON=4;const TYPE_STATUS=5;const TYPE_TITLE=6;const TYPE_CHECK_BOX=7;const TYPE_SUPER_TITLE=8;const TYPE_CONSTANT_TEXT=9;const TYPE_SLIDER=10;const SERVER_REPLY_INVALID_POST_DATA_ERROR='Invalid POST data!';const SERVER_REPLY_INVALID_NUMBER_OF_POST_ARGUMENTS_ERROR='Invalid number of POST arguments!';const SERVER_REPLY_GENERIC_NO='n';const SERVER_REPLY_GENERIC_YES='y';const SERVER_REPLY_GENERIC_SERVER_ERROR='Server Error!';const COLOR_HIGHLIGHT=0xD4FF93;const COLOR_TEXT_HIGHLIGHT='#D4FF93';const COLOR_TEXT_PLANET=0xAFE0FF;const COLOR_TEXT_DEFAULT='#67ffbf';const COLOR_TEXT_BUTTON='#60d6ff';const COLOR_TEXT_RED='#ff5e33';const COLOR_TEXT_GREEN='#6cff61';const COLOR_TEXT_CONSTANT='#7e58b0';const COLOR_WHITE='#ffffff';const COLOR_BLACK='#000000';const COLOR_HEX_BLACK=0x000000;const MOUSE_LEFT_CLICK=0;const MOUSE_MIDDLE_CLICK=1;const MOUSE_RIGHT_CLICK=2;const KEY_CODE_SHIFT=16;const KEY_CODE_SPACE=32;const KEY_CODE_UP=38;const KEY_CODE_LEFT=37;const KEY_CODE_RIGHT=39;const KEY_CODE_DOWN=40;const KEY_CODE_0=48;const KEY_CODE_1=49;const KEY_CODE_2=50;const KEY_CODE_3=51;const KEY_CODE_4=52;const KEY_CODE_5=53;const KEY_CODE_6=54;const KEY_CODE_7=55;const KEY_CODE_8=56;const KEY_CODE_9=57;const KEY_CODE_A=65;const KEY_CODE_B=66;const KEY_CODE_C=67;const KEY_CODE_D=68;const KEY_CODE_E=69;const KEY_CODE_F=70;const KEY_CODE_G=71;const KEY_CODE_H=72;const KEY_CODE_I=73;const KEY_CODE_J=74;const KEY_CODE_K=75;const KEY_CODE_L=76;const KEY_CODE_M=77;const KEY_CODE_N=78;const KEY_CODE_O=79;const KEY_CODE_P=80;const KEY_CODE_Q=81;const KEY_CODE_R=82;const KEY_CODE_S=83;const KEY_CODE_T=84;const KEY_CODE_U=85;const KEY_CODE_V=86;const KEY_CODE_W=87;const KEY_CODE_X=88;const KEY_CODE_Y=89;const KEY_CODE_Z=90;const KEY_CODE_DELETE=8;const KEY_CODE_TAB=9;const KEY_CODE_ENTER=13;const KEY_CODE_CONTROL=17;const KEY_CODE_BACK_SLASH=220;const VISIBLE='visible';const NOT_VISIBLE='hidden';const DISPLAY_NONE='none';const DISPLAY_SHOW='block';function get_nearest_power_of_two_for_number(n){var v=n;v--;v|=v>>1;v|=v>>2;v|=v>>4;v|=v>>8;v|=v>>16;v++;var x=v>>1;return(v-n)>(n-x)?x:v;}
function is_entity_property(property){switch(property){case ENTITY_DEFAULT_PROPERTY_PARENT_IDS:case ENTITY_DEFAULT_PROPERTY_CHILD_IDS:case ENTITY_DEFAULT_PROPERTY_RELATIVE_ID:case ENTITY_DEFAULT_PROPERTY_TYPE:return true;default:return property.startsWith(ENTITY_PROPERTY_START_TOKEN);}}
function CustomException(message){this.message=message;this.name='CustomException';}
function throw_exception(message){throw new CustomException(message);}
function raise_exception(message){throw new CustomException(message);}
function is_string(value){return typeof value==='string';}
function round_to_n_decimal_places(text,n){return Number(text).toFixed(n);}
function is_defined(object){return object!==null&&object!==undefined;}
function is_email_valid(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);}
function get_key_value_list_from_json_dictionary(json_data){var return_list=[];for(var key in json_data){if(json_data.hasOwnProperty(key)){return_list.push([key,json_data[key]]);}}
return return_list;}
function get_today_with_n_days_offset(n){var date=new Date();var result=new Date(date);result.setDate(result.getDate()+n);var day=result.getDate();var month=result.getMonth()+1;var year=result.getYear();return month+'/'+day+'/'+year.toString().replace('117','2017');}
function get_just_date_of_date_of_n_days_offset(n){var date=new Date();var result=new Date(date);result.setDate(result.getDate()+n);return result.getDate();}
function get_list_of_dates_consisting_of_this_and_next_week(){var dates=[];var date=new Date();var day_offset=date.getDay();if(day_offset==0){day_offset=6;}else{day_offset--;}
for(var i=0;i<14;i++){dates.push(get_today_with_n_days_offset(i-day_offset));}
return dates;}
function WebSocketClient(){this.__init__();}
WebSocketClient.prototype={_id:null,connected:null,socket:null,_world:null,player_name:null,__init__:function(){this.connected=false;},send_chat_message:function(chat_message){if(this.connected){this.socket.send(this.player_name+WEB_SOCKET_MESSAGE_TYPE_CHAT_MESSAGE+chat_message);}},send_position_and_look_at_update:function(position_string,look_at_string){if(this.connected){this.socket.send(this.player_name+WEB_SOCKET_MESSAGE_TYPE_POSITION_AND_LOOK_AT_UPDATE+position_string+'!'+look_at_string);}},send_look_at_update:function(data){if(this.connected){this.socket.send(this.player_name+WEB_SOCKET_MESSAGE_TYPE_LOOK_AT_UPDATE+data);}},send_position_update:function(data){if(this.connected){this.socket.send(this.player_name+WEB_SOCKET_MESSAGE_TYPE_POSITION_UPDATE+data);}},connect:function(player_name){this.player_name=player_name;this.socket=new WebSocket('ws://'+window.location.host+'/users/');this.socket.onmessage=function(e){var split=(e.data).split('|');var user=split[0];var command='|'+split[1]+'|';var data=split[2];MANAGER_MULTIPLAYER.perform_command(user,command,data);}.bind(this);this.socket.onopen=function open(){l('WebSockets connection created.');l('Adding player{'+this.player_name+'} to the world!');this.connected=true;l('Sending connected message');this.socket.send(this.player_name+WEB_SOCKET_MESSAGE_TYPE_CONNECTION+ENTITY_OWNER.get_username());}.bind(this);this.socket.onerror=function(error){l('Web socket connection failed, here is the error');l(error);};if(this.socket.readyState==WebSocket.OPEN){this.socket.onopen();}}};function MultiPlayerManager(){this.__init__();}
function ServerPlayer(player_name,initial_position,initial_look_at){this.__init__(player_name,initial_position,initial_look_at);}
ServerPlayer.prototype={__init__:function(player_name,initial_position,initial_look_at){this.player_name=player_name;this.position=initial_position;this.look_at=initial_look_at;this.player_title=new Floating2DText(100,player_name,TYPE_TITLE,MANAGER_WORLD.world_home.scene);var player_position=new THREE.Vector3(this.position.x,this.position.y+10,this.position.z);this.position_x_buffer=new CustomSmoothStep(this.position.x,.1);this.position_y_buffer=new CustomSmoothStep(this.position.y,.1);this.position_z_buffer=new CustomSmoothStep(this.position.z,.1);var player_look_at=new THREE.Vector3(this.look_at.x,this.look_at.y+10,this.look_at.z);this.player_title.update_position_and_look_at(player_position,player_look_at);this.geometry=new THREE.DodecahedronGeometry(10,1);this.planet_color=0x8effcb;this.material=new THREE.MeshBasicMaterial({color:0x8effcb,side:THREE.DoubleSide});this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.material.color.setHex(COLOR_TEXT_PLANET);this.player_title.update_color(COLOR_TEXT_PLANET);this.object3D=new THREE.Object3D();this.object3D.add(this.mesh);MANAGER_WORLD.world_home.add_to_scene(this.object3D);},update_position:function(position){var current_x_position=this.position_x_buffer.get_full_value();var current_y_position=this.position_y_buffer.get_full_value();var current_z_position=this.position_z_buffer.get_full_value();var delta_x=position.x-current_x_position;var delta_y=position.y-current_y_position;var delta_z=position.z-current_z_position;if(delta_x!==0){this.position_x_buffer.add_force(delta_x);}
if(delta_y!==0){this.position_y_buffer.add_force(delta_y);}
if(delta_z!==0){this.position_z_buffer.add_force(delta_z);}},update_look_at:function(look_at){var new_look_at=new THREE.Vector3(look_at.x*2+this.object3D.position.x,look_at.y*2+this.object3D.position.y+20,look_at.z*2+this.object3D.position.z);this.object3D.lookAt(new_look_at);this.player_title.update_look_at(new_look_at);},update:function(delta){this.position_x_buffer.update(delta);this.position_y_buffer.update(delta);this.position_z_buffer.update(delta);this.object3D.position.x=this.position_x_buffer.get_current_value();this.object3D.position.y=this.position_y_buffer.get_current_value();this.object3D.position.z=this.position_z_buffer.get_current_value();this.player_title.object3D.position.x=this.object3D.position.x;this.player_title.object3D.position.y=this.object3D.position.y+20;this.player_title.object3D.position.z=this.object3D.position.z;},remove:function(){MANAGER_WORLD.world_home.remove_from_scene(this.object3D);MANAGER_WORLD.world_home.remove_from_scene(this.player_title.object3D);}};MultiPlayerManager.prototype={players:null,__init__:function(){this.players=[];},update:function(delta){for(var i=0;i<this.players.length;i++){this.players[i].update(delta);}},remove_player:function(player){var index_to_remove=-1;for(var i=0;i<this.players.length;i++){if(player===this.players[i].player_name){index_to_remove=i;break;}}
if(index_to_remove!==-1){this.players[index_to_remove].remove();this.players.splice(index_to_remove,1);}},perform_command:function(user,command,data){switch(command){case WEB_SOCKET_MESSAGE_TYPE_ALL_PLAYERS:var players_data=data.split('@');for(var p=0;p<players_data.length;p++){var p_data=players_data[p].split('!');var p_name=p_data[0];var p_position=p_data[1];var p_look_at=p_data[2];this.update_player(p_name,this.get_vector_from_float_data(p_position),this.get_vector_from_float_data(p_look_at));}
break;case WEB_SOCKET_MESSAGE_TYPE_DISCONNECTED:GUI_TYPING_INTERFACE.add_server_message(user+' has logged out!');this.remove_player(user);break;case WEB_SOCKET_MESSAGE_TYPE_CHAT_MESSAGE:GUI_TYPING_INTERFACE.add_chat_message(user+' : '+data);break;case WEB_SOCKET_MESSAGE_TYPE_LOOK_AT_UPDATE:this.update_player(user,null,this.get_vector_from_float_data(data));break;case WEB_SOCKET_MESSAGE_TYPE_POSITION_UPDATE:this.update_player(user,this.get_vector_from_float_data(data),null);break;case WEB_SOCKET_MESSAGE_TYPE_POSITION_AND_LOOK_AT_UPDATE:var position=data.split('!')[0];var look_at=data.split('!')[1];this.update_player(user,this.get_vector_from_float_data(position),this.get_vector_from_float_data(look_at));break;}},update_player:function(server_player,position_update,look_at_update){if(server_player!==ENTITY_OWNER.get_username()){var user_index=-1;for(var i=0;i<this.players.length;i++){if(this.players[i].player_name===server_player){user_index=i;}}
if(user_index===-1){if(!is_defined(position_update)){position_update=new THREE.Vector3(0,0,0);l('LOOK INTO WHY POSITION IS NOT DEFINED');}
if(!is_defined(look_at_update)){look_at_update=new THREE.Vector3(0,0,0);l('LOOK INTO WHY LOOK AT IS NOT DEFINED');}
this.players.push(new ServerPlayer(server_player,position_update,look_at_update));}else{if(is_defined(position_update)){this.players[user_index].update_position(position_update);}
if(is_defined(look_at_update)){this.players[user_index].update_look_at(look_at_update);}}}},get_vector_from_float_data:function(string_of_floats){var data_split=string_of_floats.split(',');return new THREE.Vector3(parseFloat(data_split[0]),parseFloat(data_split[1]),parseFloat(data_split[2]));}};function RendererAPI(){this.__init__();}
RendererAPI.prototype={field_of_view:null,window_width:null,window_height:null,aspect_ratio:null,near_clipping:null,far_clipping:null,renderer:null,webgl_enabled:null,warning_message:null,stats_api:null,camera:null,__init__:function(){this.webgl_enabled=!!Detector.webgl;if(this.webgl_enabled===false){this.warning_message=Detector.getWebGLErrorMessage();l('WebGL is not enabled!');l(this.get_warning_message());raise_exception('WebGL is not enabled!');}else{this.stats_api=new StatsAPI();this.field_of_view=70;this.get_window_properties();this.near_clipping=1.0;this.far_clipping=20000.0;this.renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this.renderer.domElement.id='canvas_id';this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(this.window_width,this.window_height);this.renderer.setClearColor(0x000000,1);this.camera=new THREE.PerspectiveCamera(this.field_of_view,this.aspect_ratio,this.near_clipping,this.far_clipping);this.renderer.domElement.style.position='absolute';this.renderer.domElement.style.zIndex=1;this.renderer.domElement.style.top=0;document.body.appendChild(this.renderer.domElement);window.addEventListener('resize',this.on_window_resize.bind(this),false);}},pre_render:function(){this.stats_api.pre_render();},render:function(){this.renderer.render(MANAGER_WORLD.current_world.scene,this.camera);},post_render:function(){this.stats_api.post_render();},get_window_properties:function(){this.window_width=window.innerWidth;this.window_height=window.innerHeight;this.aspect_ratio=this.window_width/this.window_height;},on_window_resize:function(){this.get_window_properties();this.camera.aspect=this.aspect_ratio;this.camera.updateProjectionMatrix();this.renderer.setSize(this.window_width,this.window_height);GUI_TYPING_INTERFACE.window_was_resized();},set_camera:function(camera){this.camera=camera;},is_webgl_enabled:function(){return this.webgl_enabled;},get_warning_message:function(){return this.warning_message;}}
function ShaderAPI(renderer_api,scene,camera){this.__init__(renderer_api,scene,camera);}
ShaderAPI.prototype={composer:null,render_pass:null,__init__:function(renderer_api,scene,camera){this.composer=new THREE.EffectComposer(renderer_api.renderer);this.render_pass=new THREE.RenderPass(scene,camera);this.copy_pass=new THREE.ShaderPass(THREE.CopyShader);this.glitch_pass=new THREE.GlitchPass(0);this.composer.addPass(this.render_pass);this.composer.addPass(this.copy_pass);this.composer.addPass(this.glitch_pass);this.glitch_pass.renderToScreen=true;},render:function(){this.composer.render();}};function PostHelper(url){this.__init__(url);}
PostHelper.prototype={waiting_on_reply:null,__init__:function(url){this.url=url;},perform_post:function(post_data,callback){var self=this;this.waiting_on_reply=true;l('Performing a post with the following data for the url : {'+self.url+'}');l(post_data);const http=new XMLHttpRequest();http.open('POST',this.url,true);http.setRequestHeader('Content-type','application/json');http.send(JSON.stringify(post_data));http.onload=function(){l('POST onload response :');callback(http.responseText);self.waiting_on_reply=false;};}};function GlobalPostCall(url){this.__init__(url);}
GlobalPostCall.prototype={default_callback:function(){},__init__:function(url){this.post_call=new PostHelper(url);},perform_call:function(){this.post_call.perform_post({},this.default_callback);}};function clamp(x,lowerlimit,upperlimit){if(x<lowerlimit){x=lowerlimit;}
if(x>upperlimit){x=upperlimit;}
return x;}
function smoothstep(edge0,edge1,x){x=clamp((x-edge0)/(edge1-edge0),0.0,1.0);return x*x*(3-2*x);}
function CustomSmoothStep(current_value,time_needed_for_each_force,minimum_value,maximum_value){this.__init__(current_value,time_needed_for_each_force,minimum_value,maximum_value);}
CustomSmoothStep.prototype={buffer:null,current_value:null,time_needed_for_each_force:null,minimum_value:null,maximum_value:null,__init__:function(current_value,percentage_of_second_for_each_force,minimum_value,maximum_value){this.buffer=[];this.current_value=current_value;this.time_needed_for_each_force=percentage_of_second_for_each_force;this.minimum_value=minimum_value;this.maximum_value=maximum_value;},clear_buffer:function(){this.buffer.length=0;},set_value:function(value){this.current_value=value;if(is_defined(this.minimum_value)){if(this.current_value<this.minimum_value){return this.minimum_value;}}
if(is_defined(this.maximum_value)){if(this.current_value>this.maximum_value){return this.maximum_value;}}},add_force:function(magnitude){var current_value=this.get_current_value();var add_value=true;if(is_defined(this.minimum_value)){if(current_value+magnitude<this.minimum_value){add_value=false;}}
if(is_defined(this.maximum_value)){if(current_value+magnitude>this.maximum_value){add_value=false;}}
if(add_value){this.buffer.push([magnitude,0.0]);}},update:function(delta){for(var i=0;i<this.buffer.length;i++){this.buffer[i][1]+=delta;if(this.buffer[i][1]>=this.time_needed_for_each_force){this.current_value+=this.buffer[i][0];this.buffer.splice(i,1);}}},_get_capped_value:function(value){if(is_defined(this.minimum_value)){if(value<this.minimum_value){return this.minimum_value;}}
if(is_defined(this.maximum_value)){if(value>this.maximum_value){return this.maximum_value;}}
return value;},get_current_value:function(){var value_instance=this.current_value;for(var x=0;x<this.buffer.length;x++){value_instance+=clamp(this.time_needed_for_each_force,this.buffer[x][1])*this.buffer[x][0];}
return this._get_capped_value(value_instance);},get_full_value:function(){var value_instance=this.current_value;for(var x=0;x<this.buffer.length;x++){value_instance+=1.0*this.buffer[x][0];}
return this._get_capped_value(value_instance);}};function AudioManager(){this.__init__();}
AudioManager.prototype={player:null,audio_listener:null,loader:null,typing_sound:null,typing_sound_loaded:null,hover_over_sound:null,hover_over_sound_loaded:null,current_audio_level:null,__init__:function(){this.audio_listener=new THREE.AudioListener();CURRENT_PLAYER.camera.add(this.audio_listener);this.typing_sound=new THREE.Audio(this.audio_listener);this.typing_sound_loaded=false;this.loader=new THREE.AudioLoader();this.loader.load('/home/git_repos/quasar_source/quasar_source_code/quasar_site_django/static/audio/typing_sound.wav',function(audio_buffer){this.typing_sound.setBuffer(audio_buffer);this.typing_sound.setVolume(0.33);this.typing_sound_loaded=true;MANAGER_WORLD.add_to_all_scenes(MANAGER_AUDIO.get_typing_sound());}.bind(this),function(xhr){l((xhr.loaded/xhr.total*100)+'% loaded for audio file.');},function(xhr){l('An error happened trying to load the audio file.');});},get_typing_sound:function(){return this.typing_sound;},play_typing_sound:function(){if(this.typing_sound_loaded){if(this.typing_sound.isPlaying){this.typing_sound.stop();}
this.typing_sound.play();}}};function InputTextProcessor(current_text){this.__init__(current_text);}
const CURSOR_COLOR='#a92200';InputTextProcessor.prototype={current_text:null,__init__:function(current_text){this.current_text=current_text;},parse_key_event:function(event){var key_code=event.keyCode;if(key_code===KEY_CODE_DELETE){if(this.current_text.length>0){this.current_text=this.current_text.slice(0,-1);}}else if(event.key.length===1){this.current_text+=event.key;}},clear_text:function(){this.current_text='';},get_text:function(){return this.current_text;}};function Entity(properties){this.__init__(properties);}
Entity.prototype={ep_relative_id:null,ep_child_ids:null,ep_parent_ids:null,ep_parents:null,ep_children:null,ep_type:null,needs_to_be_saved:null,__init__:function(properties){var value=null;if(properties.hasOwnProperty(ENTITY_DEFAULT_PROPERTY_RELATIVE_ID)){value=properties[ENTITY_DEFAULT_PROPERTY_RELATIVE_ID];if(is_string(value)){this.ep_relative_id=parseInt(value);}else{this.ep_relative_id=value;}}else{this.ep_relative_id=MANAGER_ENTITY.get_new_entity_id();}
if(properties.hasOwnProperty(ENTITY_DEFAULT_PROPERTY_CHILD_IDS)){value=properties[ENTITY_DEFAULT_PROPERTY_CHILD_IDS];if(is_string(value)){this.ep_child_ids=eval(value);}else{this.ep_child_ids=value;}}else{this.ep_child_ids=[];}
if(properties.hasOwnProperty(ENTITY_DEFAULT_PROPERTY_PARENT_IDS)){value=properties[ENTITY_DEFAULT_PROPERTY_PARENT_IDS];if(is_string(value)){this.ep_parent_ids=eval(value);}else{this.ep_parent_ids=value;}}else{this.ep_parent_ids=[];}
if(properties.hasOwnProperty(ENTITY_DEFAULT_PROPERTY_TYPE)){l('Setting Entity type to ');l(properties[ENTITY_DEFAULT_PROPERTY_TYPE]);this.ep_type=properties[ENTITY_DEFAULT_PROPERTY_TYPE];}else{this.ep_type=ENTITY_TYPE_BASE;}
for(var key in properties){if(properties.hasOwnProperty(key)){if(key!==ENTITY_DEFAULT_PROPERTY_RELATIVE_ID&&key!==ENTITY_DEFAULT_PROPERTY_CHILD_IDS&&key!==ENTITY_DEFAULT_PROPERTY_PARENT_IDS&&ENTITY_DEFAULT_PROPERTY_TYPE){if(key.startsWith(ENTITY_PROPERTY_START_TOKEN)){this.set_property(key,properties[key]);}}}}
this.parents=[];this.children=[];MANAGER_ENTITY.add_entity_if_not_already_added(this);},is_owned_by_user:function(){return this.get_value(ENTITY_PROPERTY_OWNER)===ENTITY_OWNER.get_username();},set_property:function(property_name,property_value){this[property_name]=property_value;this.needs_to_be_saved=true;},update_values:function(new_keys_and_values){for(var key in new_keys_and_values){if(new_keys_and_values.hasOwnProperty(key)){this[key]=new_keys_and_values[key];}}
this.needs_to_be_saved=true;},has_property:function(property_name){return this.hasOwnProperty(property_name);},get_relative_id:function(){return this[ENTITY_DEFAULT_PROPERTY_RELATIVE_ID];},get_type:function(){return this[ENTITY_DEFAULT_PROPERTY_TYPE];},get_value:function(property_name){return this[property_name];},get_name:function(){return this.name;},get_all_properties:function(){var properties={};var all_keys=Object.keys(this);for(var i=0;i<all_keys.length;i++){if(all_keys[i].startsWith(ENTITY_PROPERTY_START_TOKEN)){properties[all_keys[i]]=this.get_value(all_keys[i]);}}
properties[ENTITY_DEFAULT_PROPERTY_TYPE]=this.get_type();properties[ENTITY_DEFAULT_PROPERTY_CHILD_IDS]=this.get_child_ids();properties[ENTITY_DEFAULT_PROPERTY_PARENT_IDS]=this.get_parent_ids();properties[ENTITY_DEFAULT_PROPERTY_RELATIVE_ID]=this.get_relative_id();return properties;},get_child_ids:function(){return this[ENTITY_DEFAULT_PROPERTY_CHILD_IDS];},get_parent_ids:function(){return this[ENTITY_DEFAULT_PROPERTY_PARENT_IDS];},number_of_parents:function(){return this.parents.length;},number_of_children:function(){return this.children.length;},add_child:function(child_entity){if(!is_defined(child_entity)){var error_message='Error can\'t add a not defined object as a child entity!';l(error_message);GUI_TYPING_INTERFACE.add_server_message(error_message);throw_exception(error_message);}
var action_occurred=false;if(this.children.indexOf(child_entity)===NOT_FOUND){this.children.push(child_entity);action_occurred=true;}
var child_entity_id=child_entity.get_relative_id();if(this.get_child_ids().indexOf(child_entity_id)===NOT_FOUND){this[ENTITY_DEFAULT_PROPERTY_CHILD_IDS].push(child_entity_id);action_occurred=true;}
if(action_occurred){this.needs_to_be_saved=true;child_entity.add_parent(this);}},remove_child:function(child_entity){if(!is_defined(child_entity)){var error_message='Error can\'t remove a not defined object as a child entity!';l(error_message);GUI_TYPING_INTERFACE.add_server_message(error_message);throw_exception(error_message);}
var index_of_child_id=this.get_child_ids().indexOf(child_entity.get_relative_id());var index_of_child_object=this.children.indexOf(child_entity);var action_occurred=false;if(index_of_child_id!==NOT_FOUND){this[ENTITY_DEFAULT_PROPERTY_CHILD_IDS].splice(index_of_child_id,1);action_occurred=true;}
if(index_of_child_object!==NOT_FOUND){this.children.splice(index_of_child_object,1);action_occurred=true;}
if(action_occurred){this.needs_to_be_saved=true;child_entity.remove_parent(this);}},add_parent:function(parent_entity){if(!is_defined(parent_entity)){var error_message='Error can\'t add a not defined object as a parent entity!';l(error_message);GUI_TYPING_INTERFACE.add_server_message(error_message);throw_exception(error_message);}
var action_occurred=false;if(this.parents.indexOf(parent_entity)===NOT_FOUND){this.parents.push(parent_entity);action_occurred=true;}
var parent_entity_id=parent_entity.get_relative_id();if(this.get_parent_ids().indexOf(parent_entity_id)===NOT_FOUND){this[ENTITY_DEFAULT_PROPERTY_PARENT_IDS].push(parent_entity_id);action_occurred=true;}
if(action_occurred){this.needs_to_be_saved=true;parent_entity.add_child(this);}},remove_parent:function(parent_entity){if(!is_defined(parent_entity)){var error_message='Error can\'t remove a not defined object as a parent entity!';l(error_message);GUI_TYPING_INTERFACE.add_server_message(error_message);throw_exception(error_message);}
var action_occurred=false;var index_of_parent_id=this.get_parent_ids().indexOf(parent_entity.get_relative_id());var index_of_parent_object=this.parents.indexOf(parent_entity);if(index_of_parent_id!==NOT_FOUND){this[ENTITY_DEFAULT_PROPERTY_PARENT_IDS].splice(index_of_parent_id,1);action_occurred=true;}
if(index_of_parent_object!==NOT_FOUND){this.parents.splice(index_of_parent_object,1);action_occurred=true;}
if(action_occurred){this.needs_to_be_saved=true;parent_entity.remove_child(this);}}};function EntityOwner(username,password){this.__init__(username,password);}
EntityOwner.prototype={ep_setting_camera_fov:null,ep_setting_master_volume:null,__init__:function(username,password){this.username=username;this.password=password;},get_username:function(){return this.username;},get_password:function(){return this.password;}};function EntityManager(){this.__init__();}
EntityManager.prototype={entities:null,public_entities:null,post_delete_entity:null,post_save_entity:null,post_load_user_entities:null,post_load_public_entities:null,user_entities_loaded:null,public_entities_loaded:null,loading:null,all_public_entities_loaded:function(data){l('Got the following data for public entities');l(data);if(is_string(data)){if(data==='{}'){this.public_entities_loaded=true;if(this.user_entities_loaded){this.all_data_loaded();}
return;}
data=JSON.parse(data);}
for(var key in data){if(data.hasOwnProperty(key)){MANAGER_ENTITY.add_public_entity_from_entity_data(data[key]);}}
this.public_entities_loaded=true;if(this.user_entities_loaded){this.all_data_loaded();}},all_user_entities_loaded:function(data){l('Got the following data for user entities');l(data);if(is_string(data)){if(data==='{}'){this.user_entities_loaded=true;if(this.public_entities_loaded){this.all_data_loaded();}
return;}
data=JSON.parse(data);}
for(var key in data){if(data.hasOwnProperty(key)){MANAGER_ENTITY.add_user_entity_from_entity_data(data[key]);}}
this.user_entities_loaded=true;this.set_owner_entity();if(this.public_entities_loaded){this.all_data_loaded();}},all_data_loaded:function(){MANAGER_ENTITY.link_entities();this.loading=false;},delete_all_children_of_entity_that_do_not_have_other_parents:function(parent_entity){for(var c=parent_entity.children.length;c--;){var child_entity=parent_entity.children[c];child_entity.remove_parent(parent_entity);if(child_entity.number_of_parents()===0){this.delete_entity(child_entity);}}},entity_deleted_response:function(data){if(data===SERVER_REPLY_GENERIC_YES){l('Entity deleted!');}else{l('Entity did not get deleted : {|'+data+'|}');}},delete_entity:function(entity){var entity_to_delete=null;var index_to_splice=this._get_index_of_entity(entity);if(index_to_splice!==NOT_FOUND){entity_to_delete=this.entities[index_to_splice];}else{raise_exception('Entity to delete was not found!');}
if(entity_to_delete!==null){this.delete_all_children_of_entity_that_do_not_have_other_parents(entity_to_delete);var data={};data[ENTITY_PROPERTY_USERNAME]=CURRENT_PLAYER.get_username();data[ENTITY_PROPERTY_PASSWORD]=CURRENT_PLAYER.get_password();data[ENTITY_DEFAULT_PROPERTY_RELATIVE_ID]=entity_to_delete.get_relative_id();this.post_delete_entity.perform_post(data,this.entity_deleted_response.bind(this));}
if(index_to_splice!==NOT_FOUND){this.entities.splice(this._get_index_of_entity(entity),1);}},__init__:function(){this.entities=[];this.public_entities=[];this.user_entities_loaded=false;this.public_entities_loaded=false;this.loading=false;this.post_delete_entity=new PostHelper(POST_URL_DELETE_ENTITY);this.post_save_entity=new PostHelper(POST_URL_SAVE_ENTITY);this.post_load_user_entities=new PostHelper(POST_URL_GET_USER_ENTITIES);this.post_load_public_entities=new PostHelper(POST_URL_GET_PUBLIC_ENTITIES);},set_owner_entity:function(){},load_data:function(){this.loading=true;var data={};data[ENTITY_PROPERTY_USERNAME]=ENTITY_OWNER.get_username();data[ENTITY_PROPERTY_PASSWORD]=ENTITY_OWNER.get_password();this.post_load_user_entities.perform_post(data,this.all_user_entities_loaded.bind(this));this.post_load_public_entities.perform_post({},this.all_public_entities_loaded.bind(this));},link_entities:function(){for(var e=0;e<this.entities.length;e++){var children_ids=this.entities[e].get_child_ids();var parent_ids=this.entities[e].get_parent_ids();for(var c=0;c<children_ids.length;c++){this.entities[e].add_child(this.get_entity_by_id(children_ids[c]));}
for(var p=0;p<parent_ids.length;p++){this.entities[e].add_parent(this.get_entity_by_id(parent_ids[p]));}}},get_new_entity_id:function(){var max_id=-1;for(var i=0;i<this.entities.length;i++){var entity_id=this.entities[i].get_relative_id();if(entity_id>max_id){max_id=entity_id;}}
return max_id+1;},get_all_entities_of_type:function(entity_type){var entities_to_return=[];for(var i=0;i<this.entities.length;i++){if(this.entities[i].get_type()===entity_type){entities_to_return.push(this.entities[i]);}}
return entities_to_return;},currently_loading:function(){return this.loading;},is_property_user_modifiable:function(property){switch(property){case ENTITY_DEFAULT_PROPERTY_CHILD_IDS:case ENTITY_DEFAULT_PROPERTY_TYPE:case ENTITY_DEFAULT_PROPERTY_PARENT_IDS:case ENTITY_DEFAULT_PROPERTY_RELATIVE_ID:return false;default:return true;}},clear_all:function(){this.user_entities_loaded=false;this.public_entities_loaded=false;this.entities.length=0;},add_entity_if_not_already_added:function(entity){if(entity.has_property(ENTITY_PROPERTY_PUBLIC)){for(var i=0;i<this.public_entities.length;i++){if(this.public_entities[i].get_relative_id()===entity.get_relative_id()){return;}}
this.public_entities.push(entity);}else{for(var j=0;j<this.entities.length;j++){if(this.entities[j].get_relative_id()===entity.get_relative_id()){return;}}
this.entities.push(entity);}},_get_index_of_entity:function(entity){for(var i=0;i<this.entities.length;i++){if(this.entities[i].get_relative_id()===entity.get_relative_id()){return i;}}
return NOT_FOUND;},delete_entity_by_id:function(entity_id){var entity=this.get_entity_by_id(entity_id);if(entity!==null){this.delete_entity(entity);}else{l('No Entity found for the ID{'+entity_id+'}');}},add_user_entity_from_entity_data:function(entity_data){return new Entity(entity_data);},add_public_entity_from_entity_data:function(entity_data){return new Entity(entity_data);},get_all_entities:function(){return this.entities;},get_owner_entity:function(){return this.get_all_entities_of_type(ENTITY_TYPE_OWNER)[0];},get_entity_by_id:function(entity_id){var match_found_ONLY_FOR_DEBUGGING=false;for(var i=0;i<this.entities.length;i++){if(this.entities[i].get_relative_id()===entity_id){match_found_ONLY_FOR_DEBUGGING=true;return this.entities[i];}}
if(!match_found_ONLY_FOR_DEBUGGING){l('MATCH NOT FOUND FOR :');l(entity_id);throw_exception('Entity ID match not found!');}
return null;},save_changes_result:function(){if(arguments[1]===SERVER_REPLY_GENERIC_YES){arguments[0].needs_to_be_saved=false;}else{l('Error saving entity : ');l(arguments[0]);}},update_server_and_database:function(){var username=ENTITY_OWNER.get_username();var password=ENTITY_OWNER.get_password();for(var e=0;e<this.entities.length;e++){if(this.entities[e].needs_to_be_saved){var data={};data[ENTITY_PROPERTY_USERNAME]=username;data[ENTITY_PROPERTY_PASSWORD]=password;data['save_data']=JSON.stringify(this.entities[e].get_all_properties());this.post_save_entity.perform_post(data,this.save_changes_result.bind(this,this.entities[e]));}}}};function FPSControls(camera){this.__init__(camera);}
FPSControls.prototype={camera:null,pitch:null,yaw:null,enabled:null,up:null,down:null,left:null,right:null,velocity:null,acceleration:null,flying_on:null,left_right:null,walking_direction:null,direction_object3D:null,camera_object3D:null,max_upward_view:null,max_downward_view:null,direction_vector:null,mouse_movement_x_buffer:null,mouse_movement_y_buffer:null,half_pie:null,max_view_angle:null,diagonal_penalty:null,ground_normal:null,__init__:function(camera){this.diagonal_penalty=Math.sqrt(.5);this.ground_normal=new THREE.Vector3(0,1,0);this.camera=camera;this.pitch=new THREE.Object3D();this.pitch.add(camera);this.yaw=new THREE.Object3D();this.yaw.add(this.pitch);this.enabled=false;this.flying_on=true;this.velocity=new THREE.Vector3();this.mouse_movement_x_buffer=new CustomSmoothStep(this.yaw.rotation.y,0.025,null,null);this.mouse_movement_y_buffer=new CustomSmoothStep(this.pitch.rotation.x,0.025,-1.0*HALF_PIE,HALF_PIE);document.addEventListener('mousemove',this.on_mouse_move.bind(this),false);document.addEventListener('keydown',this.on_key_down.bind(this),false);document.addEventListener('keyup',this.on_key_up.bind(this),false);},toggle_flying:function(){this.flying_on=!this.flying_on;if(this.flying_on){this.velocity.y=0;}},fly_left:function(delta){this.velocity.x+=200*delta*this.left_right.x;this.velocity.y+=200*delta*this.left_right.y;this.velocity.z+=200*delta*this.left_right.z;},fly_right:function(delta){this.velocity.x-=200*delta*this.left_right.x;this.velocity.y-=200*delta*this.left_right.y;this.velocity.z-=200*delta*this.left_right.z;},fly_forward:function(delta){this.velocity.x+=200*delta*this.direction_vector.x;this.velocity.y+=200*delta*this.direction_vector.y;this.velocity.z+=200*delta*this.direction_vector.z;},fly_backward:function(delta){this.velocity.x-=200*delta*this.direction_vector.x;this.velocity.y-=200*delta*this.direction_vector.y;this.velocity.z-=200*delta*this.direction_vector.z;},move_forward:function(delta){this.velocity.x+=200*delta*this.direction_vector.x;this.velocity.z+=200*delta*this.direction_vector.z;},move_backward:function(delta){this.velocity.x-=200*delta*this.direction_vector.x;this.velocity.z-=200*delta*this.direction_vector.z;},move_left:function(delta){this.velocity.x+=200*delta*this.left_right.x;this.velocity.z+=200*delta*this.left_right.z;},move_right:function(delta){this.velocity.x-=200*delta*this.left_right.x;this.velocity.z-=200*delta*this.left_right.z;},physics:function(delta){this.mouse_movement_x_buffer.update(delta);this.mouse_movement_y_buffer.update(delta);this.update_mouse_view_position();if(this.enabled){if(this.flying_on){if(this.space){this.velocity.y+=200.0*delta;}
if(this.shift){this.velocity.y-=200.0*delta;}
if((this.up^this.down)&(this.left^this.right)){if(this.up){this.fly_forward(delta*this.diagonal_penalty);}else{this.fly_backward(delta*this.diagonal_penalty);}
if(this.left){this.fly_left(delta*this.diagonal_penalty);}else{this.fly_right(delta*this.diagonal_penalty);}}else if(this.up^this.down){if(this.up){this.fly_forward(delta);}else{this.fly_backward(delta);}}else if(this.left^this.right){if(this.left){this.fly_left(delta);}else{this.fly_right(delta);}}
this.velocity.y*=(1-delta*15);this.yaw.position.y+=this.velocity.y;}else{if((this.up^this.down)&(this.left^this.right)){if(this.up){this.move_forward(delta*this.diagonal_penalty);}else{this.move_backward(delta*this.diagonal_penalty);}
if(this.left){this.move_left(delta*this.diagonal_penalty);}else{this.move_right(delta*this.diagonal_penalty);}}else if(this.up^this.down){if(this.up){this.fly_forward(delta);}else{this.fly_backward(delta);}}else if(this.left^this.right){if(this.left){this.move_left(delta);}else{this.move_right(delta);}}
if(this.velocity.y!=0){this.velocity.y-=9.8*delta*10;this.velocity.y*=(1-delta*15);this.yaw.position.y+=this.velocity.y;if(this.yaw.position.y<=10){this.yaw.position.y=10;this.velocity.y=0;}}}}
this.velocity.x*=(1-delta*15);this.velocity.z*=(1-delta*15);this.yaw.position.x+=this.velocity.x;this.yaw.position.z+=this.velocity.z;},get_position:function(){return this.yaw.position;},get_velocity:function(){return this.velocity;},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;this.up=false;this.down=false;this.left=false;this.right=false;this.space=false;this.shift=false;},on_key_down:function(event){switch(event.keyCode){case KEY_CODE_UP:case KEY_CODE_W:this.up=true;break;case KEY_CODE_LEFT:case KEY_CODE_A:this.left=true;break;case KEY_CODE_DOWN:case KEY_CODE_S:this.down=true;break;case KEY_CODE_RIGHT:case KEY_CODE_D:this.right=true;break;case KEY_CODE_SPACE:this.space=true;break;case KEY_CODE_SHIFT:this.shift=true;break;}},on_key_up:function(event){switch(event.keyCode){case KEY_CODE_UP:case KEY_CODE_W:this.up=false;break;case KEY_CODE_LEFT:case KEY_CODE_A:this.left=false;break;case KEY_CODE_DOWN:case KEY_CODE_S:this.down=false;break;case KEY_CODE_RIGHT:case KEY_CODE_D:this.right=false;break;case KEY_CODE_SPACE:this.space=false;break;case KEY_CODE_SHIFT:this.shift=false;break;}},look_at:function(position_vector_to_look_at){var look_at_normal=new THREE.Vector3(position_vector_to_look_at.x,position_vector_to_look_at.y,position_vector_to_look_at.z);look_at_normal.sub(this.yaw.position);look_at_normal.normalize();var look_at_angle=Math.atan2(look_at_normal.z,look_at_normal.x);var d=this.get_direction();var x_rotation=new THREE.Vector2(d.x,d.z);x_rotation.normalize();var angle=Math.atan2(x_rotation.y,x_rotation.x);var current_x_value=this.mouse_movement_x_buffer.get_current_value();this.mouse_movement_x_buffer.clear_buffer();this.mouse_movement_x_buffer.set_value(current_x_value+(-1.0*(look_at_angle-angle)));this.mouse_movement_y_buffer.clear_buffer();this.mouse_movement_y_buffer.set_value(Math.asin(look_at_normal.y));},update_mouse_view_position:function(){this.yaw.rotation.y=this.mouse_movement_x_buffer.get_current_value();this.pitch.rotation.x=this.mouse_movement_y_buffer.get_current_value();this.pitch.rotation.x=Math.max(-0.999*HALF_PIE,Math.min(HALF_PIE-0.001,this.mouse_movement_y_buffer.get_current_value()));this.direction_vector=this.get_direction();this.direction_vector.normalize();this.left_right=new THREE.Vector3(0,1,0);this.left_right.cross(this.direction_vector);this.left_right.normalize();if(!this.flying_on){this.walking_direction=new THREE.Vector3(this.direction_vector.x,this.direction_vector.y,this.direction_vector.z);this.walking_direction=this.walking_direction.projectOnPlane(this.ground_normal);this.walking_direction.normalize();}},on_mouse_move:function(event){var movement_x=event.movementX||event.mozMovementX||event.webkitMovementX||0;if(this.enabled){var movement_y=event.movementY||event.mozMovementY||event.webkitMovementY||0;this.mouse_movement_x_buffer.add_force(movement_x*-0.002);this.mouse_movement_y_buffer.add_force(movement_y*-0.002);}
if(CURRENT_PLAYER.is_engaged()){var c=MANAGER_WORLD.current_world.currently_looked_at_object;if(is_defined(c)){if(c.requires_mouse_x_movement){c.provide_mouse_x_movement(movement_x);}}}},get_direction:function(){var direction=new THREE.Vector3(0,0,-1);var rotation=new THREE.Euler(this.mouse_movement_y_buffer.get_current_value(),this.mouse_movement_x_buffer.get_current_value(),0,'YXZ');return direction.applyEuler(rotation);}};function PointerLockAPI(controls){this.__init__(controls);}
PointerLockAPI.prototype={has_pointer_lock:null,element:null,currently_locked:false,controls:null,l_key_currently_down:false,key_down_buffer:null,__init__:function(controls){this.controls=controls;this.element=document.body;this.has_pointer_lock='pointerLockElement'in document||'mozPointerLockElement'in document||'webkitPointerLockElement'in document;if(this.has_pointer_lock===true){document.addEventListener('pointerlockchange',this.pointer_lock_change.bind(this),false);document.addEventListener('mozpointerlockchange',this.pointer_lock_change.bind(this),false);document.addEventListener('webkitpointerlockchange',this.pointer_lock_change.bind(this),false);document.addEventListener('pointerlockerror',this.pointer_lock_error.bind(this),false);document.addEventListener('mozpointerlockerror',this.pointer_lock_error.bind(this),false);document.addEventListener('webkitpointerlockerror',this.pointer_lock_error.bind(this),false);this.key_down_buffer=[];document.addEventListener('click',this.click_handler.bind(this));}else{l('Pointer lock is not supported!');GUI_TYPING_INTERFACE.add_server_message('Pointer lock is not supported!');}},pointer_lock_change:function(){if(document.pointerLockElement===this.element||document.mozPointerLockElement===this.element||document.webkitPointerLockElement===this.element){this.currently_locked=true;if(!GUI_TYPING_INTERFACE.is_visible()){this.controls.enable();}}else{this.currently_locked=false;this.controls.disable();CURRENT_PLAYER.disengage();var currently_looked_at_object=MANAGER_WORLD.current_world.currently_looked_at_object;if(currently_looked_at_object!==null){currently_looked_at_object.is_engaged();currently_looked_at_object.disengage();}
GUI_PAUSED_MENU.make_visible();}},pointer_lock_error:function(){l('Pointer lock error!');GUI_TYPING_INTERFACE.add_server_message('Pointer lock error!');},click_handler:function(e){var current_milliseconds=new Date().getTime();for(var i=this.key_down_buffer.length;i--;){if(current_milliseconds-this.key_down_buffer[i]>=300){this.key_down_buffer.splice(i,1);}}
this.key_down_buffer.push(current_milliseconds);if(this.key_down_buffer.length==1){if(this.currently_locked!==false){switch(e.button){case MOUSE_LEFT_CLICK:MANAGER_WORLD.current_world.single_left_click();break;case MOUSE_MIDDLE_CLICK:MANAGER_WORLD.current_world.single_middle_click();break;case MOUSE_RIGHT_CLICK:MANAGER_WORLD.current_world.single_right_click();break;}}}else if(this.key_down_buffer.length==2){this.try_to_enable();}},try_to_enable:function(){if(this.currently_locked===false){this.element.requestPointerLock=this.element.requestPointerLock||this.element.mozRequestPointerLock||this.element.webkitRequestPointerLock;this.element.requestPointerLock();GUI_PAUSED_MENU.make_invisible();}}};function StatsAPI(){this.__init__();}
StatsAPI.prototype={stats_fps:null,enabled:null,__init__:function(){this.enabled=true;this.stats_fps=new Stats();this.stats_fps.showPanel(0);this.stats_fps.domElement.style.position='absolute';this.stats_fps.domElement.style.left='0px';this.stats_fps.domElement.style.top='0px';this.add_to_document();},add_to_document:function(){document.body.appendChild(this.stats_fps.domElement);},pre_render:function(){if(this.enabled){this.stats_fps.begin();}},post_render:function(){if(this.enabled){this.stats_fps.end();}},toggle:function(){this.enabled=!this.enabled;}};function DataDisplay(fps_controls){this.__init__(fps_controls);}
DataDisplay.prototype={x_coordinate:null,y_coordinate:null,z_coordinate:null,x_direction:null,y_direction:null,z_direction:null,fps_controls:null,enabled:null,__init__:function(fps_controls){this.fps_controls=fps_controls;this.enabled=true;this.x_coordinate=document.getElementById('x_coordinate');this.y_coordinate=document.getElementById('y_coordinate');this.z_coordinate=document.getElementById('z_coordinate');this.x_direction=document.getElementById('x_direction');this.y_direction=document.getElementById('y_direction');this.z_direction=document.getElementById('z_direction');},rounded:function(n){return Number(n).toFixed(3);},update:function(){if(this.enabled){var position=this.fps_controls.get_position();var direction=this.fps_controls.get_direction();this.x_coordinate.textContent='x : '+this.rounded(position.x)+' | '+this.rounded(this.fps_controls.get_velocity().x);this.y_coordinate.textContent='y : '+this.rounded(position.y)+' | '+this.rounded(this.fps_controls.get_velocity().y);this.z_coordinate.textContent='z : '+this.rounded(position.z)+' | '+this.rounded(this.fps_controls.get_velocity().z);this.x_direction.textContent='xd : '+this.rounded(direction.x);this.y_direction.textContent='yd : '+this.rounded(direction.y);this.z_direction.textContent='zd : '+this.rounded(direction.z);}},toggle:function(){this.enabled=!this.enabled;if(!this.enabled){this.x_coordinate.style.visibility='hidden';this.y_coordinate.style.visibility='hidden';this.z_coordinate.style.visibility='hidden';this.x_direction.style.visibility='hidden';this.y_direction.style.visibility='hidden';this.z_direction.style.visibility='hidden';}else{this.x_coordinate.style.visibility='visible';this.y_coordinate.style.visibility='visible';this.z_coordinate.style.visibility='visible';this.x_direction.style.visibility='visible';this.y_direction.style.visibility='visible';this.z_direction.style.visibility='visible';}}};function PausedMenu(){this.__init__();}
PausedMenu.prototype={pause_menu:null,background_coloring:null,button_resume:null,button_settings:null,button_help_controls:null,button_log_out:null,__init__:function(){this.currently_displayed=true;this.background_coloring=document.getElementById('background_coloring');this.pause_menu=document.getElementById('pause_menu');this.pause_title=document.getElementById('menu_title');this.pause_sub_title=document.getElementById('menu_header');this.button_resume=document.getElementById('button_resume');this.button_settings=document.getElementById('button_settings');this.button_help_controls=document.getElementById('button_help_controls');this.button_log_out=document.getElementById('button_log_out');this.button_resume.onclick=function(){this.make_invisible();CURRENT_PLAYER.pointer_lock_api.try_to_enable();}.bind(this);this.button_settings.onclick=function(){MANAGER_WORLD.set_current_world(MANAGER_WORLD.world_settings);}.bind(this);this.button_help_controls.onclick=function(){}.bind(this);this.button_log_out.onclick=function(){CURRENT_PLAYER.log_out();}.bind(this);this.pause_title.innerHTML='Paused!';this.pause_sub_title.style.display=DISPLAY_SHOW;},make_visible:function(){this.currently_displayed=true;this.pause_menu.style.display=DISPLAY_SHOW;this.button_resume.style.display=DISPLAY_SHOW;this.button_help_controls.style.display=DISPLAY_SHOW;if(CURRENT_PLAYER.logged_in){this.button_settings.style.display=DISPLAY_SHOW;this.button_log_out.style.display=DISPLAY_SHOW;}
this.background_coloring.id='background_coloring';},make_invisible:function(){if(this.currently_displayed){this.pause_menu.style.display=DISPLAY_NONE;this.background_coloring.id='no_background_coloring';}
this.currently_displayed=false;}};function TypingInterface(){this.__init__();}
function Message(text,created_time){this.__init__(text,created_time);}
Message.prototype={__init__:function(text,created_time){this.text=text;this.created_time=created_time;}};const MESSAGE_TYPE_PLAYER_CHAT=3;const MESSAGE_TYPE_SERVER=2;const MESSAGE_TYPE_USER=1;TypingInterface.prototype={__init__:function(){this.gui_typing=new DomElement('gui_typing');this.gui_typing_input=new DomElement('gui_typing_input_field');this.gui_logs=new DomElement('gui_console_logs');this.input_text=new InputTextProcessor('');this.visible=false;this.all_rows=[];var i=0;while(i<70){this.all_rows.push(new DomElement('row_'+i.toString()));i+=1;}
this.messages=[];this.window_was_resized();this.needs_another_update=false;},is_visible:function(){return this.visible;},toggle_visibility:function(){this.visible=!this.visible;if(this.visible){this.show();}else{this.hide();}},show:function(){this.gui_typing.show();this.visible=true;},hide:function(){this.gui_typing.hide();this.visible=false;this.input_text.clear_text();},key_down_event:function(event){this.input_text.parse_key_event(event);this.gui_typing_input.set_text(this.input_text.get_text());},window_was_resized:function(){var window_height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.current_height=window_height*0.7;var row_size=12+2;var number_of_rows_that_fit=this.current_height/row_size;this.last_row=Math.floor(number_of_rows_that_fit)-1;this.update();},get_normal_text_color:function(alpha){return'rgba(118, 255, 137, '+alpha.toString()+')';},get_server_text_color:function(alpha){return'rgba(255, 53, 36,'+alpha.toString()+')';},get_player_message_text_color:function(alpha){return'rgba(113, 236, 255, '+alpha.toString()+');';},needs_an_update:function(){return this.needs_another_update;},update:function(){var needs_one_more_update=false;var i=this.last_row;var m=0;while(i>-1){if(this.messages.length>m){this.all_rows[i].set_text(this.messages[m][0]);switch(this.messages[m][1]){case MESSAGE_TYPE_SERVER:this.all_rows[i].set_color(this.get_server_text_color(0.85));break;case MESSAGE_TYPE_USER:this.all_rows[i].set_color(this.get_normal_text_color(0.85));break;case MESSAGE_TYPE_PLAYER_CHAT:this.all_rows[i].set_color(this.get_player_message_text_color(0.85));break;}}else{this.all_rows[i].set_text('');}
i-=1;m+=1;}
var j=this.last_row+1;while(j<70){this.all_rows[j].set_text('');j+=1;}
this.needs_another_update=needs_one_more_update;},add_chat_message:function(message){this.add_message(message,MESSAGE_TYPE_PLAYER_CHAT);},add_message:function(text_message,text_color){this.messages.unshift([text_message,text_color]);this.update();},add_user_text:function(){var current_input=this.input_text.get_text();if(current_input.length>0){if(current_input[0]==='.'){switch(current_input){case'.save':this.add_server_message('Saving changes to the server!');this.update_all_home_world_entity_walls();MANAGER_ENTITY.update_server_and_database();break;case'.create_wall':MANAGER_WORLD.world_home.create_entity_wall_command_entered();break;}}else{CURRENT_PLAYER.send_chat_message(current_input);}}},add_server_message:function(server_message){this.add_message('server : '+server_message,MESSAGE_TYPE_SERVER);},update_all_home_world_entity_walls:function(){var entity_walls=MANAGER_WORLD.world_home.entity_walls;for(var i=0;i<entity_walls.length;i++){entity_walls[i].create_or_update_self_wall_entity();}}};function DomElement(id_name){this.__init__(id_name);}
DomElement.prototype={__init__:function(id_name){this.element=document.getElementById(id_name);},set_color:function(color){this.element.style.color=color;},get_element:function(){return this.element;},hide:function(){this.element.style.display=DISPLAY_NONE;this.hidden=true;},show:function(){this.element.style.display=DISPLAY_SHOW;this.hidden=false;},is_hidden:function(){return this.hidden;},set_text:function(text){this.element.innerHTML=text;},get_text:function(){return this.element.innerHTML;},clear:function(){this.element.innerHTML='';},make_invisible:function(){this.element.style.visibility=NOT_VISIBLE;this.visible=false;},make_visible:function(){this.element.style.visibility=VISIBLE;this.visible=true;},is_visible:function(){return this.visible;}};function Player(renderer_api){this.__init__(renderer_api);}
Player.prototype={mouse_locked:null,logged_in:null,engaged:null,camera:null,renderer_api:null,pointer_lock_api:null,fps_controls:null,data_display:null,key_down_ctrl:null,key_down_d:null,__init__:function(renderer_api){this.renderer_api=renderer_api;this.camera=this.renderer_api.camera;this.fps_controls=new FPSControls(this.camera);this.pointer_lock_api=new PointerLockAPI(this.fps_controls);this.data_display=new DataDisplay(this.fps_controls);this.key_down_ctrl=false;this.key_down_d=false;document.addEventListener('keydown',this.on_key_down.bind(this),false);document.addEventListener('keyup',this.on_key_up.bind(this),false);this.logged_in=false;this.engaged=false;this.web_socket_client=new WebSocketClient();this.owner_name=null;this.currently_fullscreen=false;},send_chat_message:function(chat_message){if(!is_defined(this.owner_name)){this.owner_name=MANAGER_ENTITY.get_owner_entity().get_value('owner_username');}
this.web_socket_client.send_chat_message(chat_message);},log_out:function(){l('LOG OUT HERE!!!!');MANAGER_ENTITY.clear_all();MANAGER_WORLD.world_home.loaded_entities=false;this.owner=null;MANAGER_WORLD.set_current_world(MANAGER_WORLD.world_login);this.logged_in=false;},get_password:function(){return ENTITY_OWNER.get_password();},try_to_send_position_update_to_server:function(){var position=this.get_position();var position_string=''+Math.round(position.x).toString()+','+Math.round(position.y).toString()+','+Math.round(position.z).toString();var position_was_different=false;var look_at_was_different=false;if(is_defined(this.previous_position_string)){if(position_string!==this.previous_position_string){position_was_different=true;}}
this.previous_position_string=position_string;var look_at=this.fps_controls.get_direction();var look_at_string=look_at.x.toString()+','+look_at.y.toString()+','+look_at.z.toString();if(is_defined(this.previous_look_at_string)){if(look_at_string!==this.previous_look_at_string){look_at_was_different=true;}}
this.previous_look_at_string=look_at_string;if(position_was_different&&look_at_was_different){this.web_socket_client.send_position_and_look_at_update(position_string,look_at_string);}else if(position_was_different){this.web_socket_client.send_position_update(position_string);}else if(look_at_was_different){this.web_socket_client.send_look_at_update(look_at_string);}},set_player_id:function(player_id){l('Setting the player id to : '+player_id);this.player_id=player_id;this.web_socket_client.connect(ENTITY_OWNER);},login:function(username,password){ENTITY_OWNER=new EntityOwner(username,password);MANAGER_ENTITY.load_data(username,password);MANAGER_WORLD.set_current_world(MANAGER_WORLD.world_home);this.logged_in=true;},enable_controls:function(){this.fps_controls.enable();},disengage:function(){if(this.engaged){this.engaged=false;}},is_engaged:function(){return this.engaged;},engage:function(){this.engaged=true;this.fps_controls.disable();},update:function(delta){this.fps_controls.physics(delta);this.data_display.update();},on_key_down:function(event){switch(event.keyCode){case KEY_CODE_CONTROL:this.key_down_ctrl=true;break;case KEY_CODE_D:this.key_down_d=true;if(this.key_down_ctrl){this.data_display.toggle();this.renderer_api.stats_api.toggle();}
break;case KEY_CODE_F:if(this.key_down_ctrl){if(!this.currently_fullscreen){THREEx.FullScreen.request();this.renderer_api.on_window_resize();}else{THREEx.FullScreen.cancel();}
this.currently_fullscreen=!this.currently_fullscreen;}
break;case KEY_CODE_ENTER:if(GUI_TYPING_INTERFACE.is_visible()){GUI_TYPING_INTERFACE.add_user_text();GUI_TYPING_INTERFACE.hide();this.disengage();this.fps_controls.enable();}else if(!this.is_engaged()){if(!is_defined(MANAGER_WORLD.current_world.currently_looked_at_object)){if(!GUI_TYPING_INTERFACE.is_visible()){GUI_TYPING_INTERFACE.show();this.engage();}}}
break;}
if(GUI_TYPING_INTERFACE.is_visible()){GUI_TYPING_INTERFACE.key_down_event(event);}else{MANAGER_WORLD.key_down_event(event);}},on_key_up:function(event){switch(event.keyCode){case KEY_CODE_CONTROL:this.key_down_ctrl=false;break;case KEY_CODE_D:this.key_down_d=false;break;}},get_position:function(){return this.fps_controls.get_position();},look_at:function(vector){this.fps_controls.look_at(vector);},set_position:function(vector){this.fps_controls.yaw.position.x=vector.x;this.fps_controls.yaw.position.y=vector.y;this.fps_controls.yaw.position.z=vector.z;}};function Interactive(){this.needs_engage_for_parsing_input=true;this.maintain_engage_when_tabbed_to=true;this.engable=true;this.requires_mouse_x_movement=false;this.engage_function=null;this.disengage_function=null;this.look_at_function=null;this.look_away_function=null;this.being_looked_at=false;this.being_engaged_with=false;this.next_tab_target=null;this.look_away=function(){this.being_looked_at=false;this.state_change_look_at(false);if(this.look_away_function!==null){this.look_away_function();}};this.look_at=function(){this.being_looked_at=true;this.state_change_look_at(true);if(this.look_at_function!==null){this.look_at_function();}};this.disengage=function(){this.being_engaged_with=false;if(this.engable){this.state_change_engage(false);}
if(this.disengage_function!==null){this.disengage_function();}};this.is_engaged=function(){return this.being_engaged_with;};this.engage=function(){if(this.engable){this.being_engaged_with=true;this.state_change_engage(true);}
if(this.engage_function!==null){this.engage_function();}};this.set_engage_function=function(engage_function){this.engage_function=engage_function;};this.set_disengage_function=function(disengage_function){this.disengage_function=disengage_function;};this.set_look_at_function=function(look_at_function){this.look_at_function=look_at_function;};this.set_look_away_function=function(look_away_function){this.look_away_function=look_away_function;};this.set_next_tab_target=function(tab_target){this.next_tab_target=tab_target;};this.bind_increase_and_decrease_functions=function(increase_function,decrease_function){this.slider_increase_function=increase_function;this.slider_decrease_function=decrease_function;};this.provide_mouse_x_movement=function(movement_x){if(movement_x>0){if(is_defined(this.slider_increase_function)){this.slider_increase_function();}}else if(movement_x<0){if(is_defined(this.slider_decrease_function)){this.slider_decrease_function();}}};}
function Visibility(){this.currently_visible=true;this.additional_visibility_objects=[];this.add_additional_visibility_object=function(child_object){this.additional_visibility_objects.push(child_object);};this.is_visible=function(){return this.currently_visible;};this.set_to_visible=function(){this.currently_visible=true;this.object3D.visible=true;this.object3D.traverse(function(child){if(child instanceof THREE.Mesh){child.visible=true;}});for(var i=0;i<this.additional_visibility_objects.length;i++){this.additional_visibility_objects[i].set_to_visible();}};this.set_to_invisible=function(){this.currently_visible=false;this.object3D.visible=false;this.object3D.traverse(function(child){if(child instanceof THREE.Mesh){child.visible=false;}});for(var i=0;i<this.additional_visibility_objects.length;i++){this.additional_visibility_objects[i].set_to_invisible();}};this.toggle_visiblity=function(){this.currently_visible=!this.currently_visible;var local_is_visible=this.currently_visible;this.object3D.visible=local_is_visible;this.object3D.traverse(function(child){if(child instanceof THREE.Mesh){child.visible=local_is_visible;}});for(var i=0;i<this.additional_visibility_objects.length;i++){if(local_is_visible){this.additional_visibility_objects[i].set_to_visible();}else{this.additional_visibility_objects[i].set_to_invisible();}}};}
function PlaneAPI(w,h){this.__init__(w,h);}
PlaneAPI.prototype={width:null,height:null,mesh:null,geometry:null,material:null,scene:null,__init__:function(w,h){this.width=w;this.height=h;this.geometry=new THREE.PlaneGeometry(this.width,this.height);this.create();},create:function(){this.material=new THREE.MeshBasicMaterial({color:0x060606,side:THREE.FrontSide});this.mesh=new THREE.Mesh(this.geometry,this.material);var geo=new THREE.EdgesGeometry(this.mesh.geometry);var mat=new THREE.LineBasicMaterial({color:0xFFC0CB,linewidth:3});var wireframe=new THREE.LineSegments(geo,mat);this.mesh.add(wireframe);},update_position_and_look_at:function(position_vector,look_at_position){this.object3D.position.x=position_vector.x;this.object3D.position.y=position_vector.y;this.object3D.position.z=position_vector.z;this.object3D.lookAt(look_at_position);}};function FloatingWall(width,height,position,look_at,world){this.__init__(width,height,position,look_at,world);}
FloatingWall.prototype={position:null,look_at:null,world:null,scene:null,normal:null,depth_start:null,depth:null,width:null,height:null,title_text:null,title:null,interactive_objects:null,__init__:function(width,height,position,normal,world){this.position=position;this.normal=normal;this.depth_start=new THREE.Vector3(this.normal.x*2,this.normal.y*2,this.normal.z*2);this.look_at=new THREE.Vector3(this.position.x+this.depth_start.x,this.position.y+this.depth_start.y,this.position.z+this.depth_start.z);this.left_right=new THREE.Vector3(0,1,0);this.left_right.cross(this.normal);this.left_right.normalize();this.world=world;this.scene=this.world.scene;this.object3D=new THREE.Object3D();this.object3D.position.set(position.x,position.y,position.z);this.object3D.lookAt(new THREE.Vector3(this.look_at.x,this.look_at.y,this.look_at.z));Visibility.call(this);this.interactive_objects=[];this.width=width;this.height=height;this.wall=new PlaneAPI(this.width,this.height);this.object3D.add(this.wall.mesh);this.scene.add(this.object3D);this.objects_to_remove_later=[];this.all_floating_2d_texts=[];},update_position:function(position_vector){this.object3D.position.set(position_vector.x,position_vector.y,position_vector.z);if(is_defined(this.close_button)){this.update_floating_2d_text_position(position_vector,this.close_button,(this.width/2.0)-16/2,2,0,0);}},update_floating_2d_text_position:function(position_vector,floating_2d_text,x_offset,z_offset,row,additional_y_offset){var relative_x_shift=this.get_relative_x_shift(x_offset);var y_position=this.get_y_position_for_row(row)+additional_y_offset;var new_position=new THREE.Vector3(position_vector.x+relative_x_shift.x,position_vector.y+this.height/2+y_position+relative_x_shift.y,position_vector.z+relative_x_shift.z);new_position.addScaledVector(this.depth_start,z_offset);var new_look_at=new THREE.Vector3(position_vector.x+relative_x_shift.x,position_vector.y+this.height/2+y_position+relative_x_shift.y,position_vector.z+relative_x_shift.z);new_look_at.addScaledVector(this.depth_start,z_offset);new_look_at.addScaledVector(this.normal,10);floating_2d_text.update_position_and_look_at(new_position,new_look_at);},add_object_to_remove_later:function(object_to_remove){this.objects_to_remove_later.push(object_to_remove);},remove_from_scene:function(){for(var i=0;i<this.objects_to_remove_later.length;i++){this.world.remove_from_interactive_then_scene(this.objects_to_remove_later[i]);}
this.scene.remove(this.object3D);},add_close_button:function(additional_depth){if(additional_depth!==null&&additional_depth!==null){this.close_button=this.add_floating_2d_text(16,'X',TYPE_BUTTON,(this.width/2.0)-16/2,2+additional_depth,0,0);}else{this.close_button=this.add_floating_2d_text(16,'X',TYPE_BUTTON,(this.width/2.0)-16/2,2,0,0);}
this.interactive_objects.push(this.close_button);return this.close_button;},get_all_floating_2d_texts:function(){return this.all_floating_2d_texts;},add_floating_2d_text:function(width,text,type,x_offset,z_offset,row,additional_y_offset){var floating_2D_text=new Floating2DText(width,text,type,this.scene);var relative_x_shift=this.get_relative_x_shift(x_offset);var y_position=this.get_y_position_for_row(row)+additional_y_offset;floating_2D_text.update_position_and_look_at(this.get_position_for_row(relative_x_shift.x,relative_x_shift.y+y_position,relative_x_shift.z,z_offset),this.get_look_at_for_row(relative_x_shift.x,relative_x_shift.y+y_position,relative_x_shift.z,z_offset));this.add_additional_visibility_object(floating_2D_text);this.add_object_to_remove_later(floating_2D_text);this.all_floating_2d_texts.push(floating_2D_text);return floating_2D_text;},update_title:function(title){this.title.update_text(title);},get_y_position_for_row:function(y_index){return(-16.0/2.0)*(1+(2*y_index));},get_relative_x_shift:function(distance){return new THREE.Vector3(this.left_right.x*distance,this.left_right.y*distance,this.left_right.z*distance);},get_position_for_row:function(x_offset,y_offset,z_offset,depth){var p=new THREE.Vector3(this.object3D.position.x+x_offset,this.object3D.position.y+this.height/2+y_offset,this.object3D.position.z+z_offset);p.addScaledVector(this.depth_start,depth);return p;},get_look_at_for_row:function(x_offset,y_offset,z_offset,depth){var la=new THREE.Vector3(this.look_at.x+x_offset,this.look_at.y+this.height/2+y_offset,this.look_at.z+z_offset);la.addScaledVector(this.depth_start,depth);return la;},get_all_interactive_objects:function(){return this.interactive_objects;}};function Floating2DText(w,text,type,scene){this.__init__(w,text,type,scene);}
function Floating2DLabelInput(w,label_text,input_type,scene){this.__init__(w,label_text,input_type,scene);}
Floating2DLabelInput.prototype={floating_label:null,floating_input:null,one_third_width:null,two_third_width:null,x_separation:null,__init__:function(w,label_text,input_type,scene){this.one_third_width=w/3.0;this.two_third_width=this.one_third_width*2.0;this.x_separation=w/2.0;this.floating_label=new Floating2DText(this.one_third_width,label_text,TYPE_LABEL,scene);this.floating_input=new Floating2DText(this.two_third_width,'',input_type,scene);this.floating_input.also_color_this_floating_text=this.floating_label;},update_position:function(px,py,pz){this.floating_label.update_position_and_look_at(new THREE.Vector3(px+this.one_third_width/2,py,pz),new THREE.Vector3(px+this.one_third_width/2,py,pz+1));this.floating_input.update_position_and_look_at(new THREE.Vector3(px+this.two_third_width/2+this.one_third_width,py,pz),new THREE.Vector3(px+this.two_third_width/2+this.one_third_width,py,pz+1));},set_input_value:function(input_value){this.floating_input.force_update_text(input_value);},get_input_text:function(){return this.floating_input.get_text().trim();}};Floating2DText.prototype={_hidden_text:null,text:null,width:null,material:null,dynamic_texture:null,object3D:null,scene:null,wireframe:null,type:null,original_border_color:null,also_color_this_floating_text:null,default_color:null,label:null,label_position:null,__init__:function(w,text,type,scene){this.scene=scene;this.width=w;this.text=text;this._hidden_text='';this.original_border_color=0xFFC0CB;this.type=type;if(this.type===TYPE_TITLE){this.height=32;}else{this.height=16;}
Interactive.call(this);Visibility.call(this);switch(this.type){case TYPE_BUTTON:case TYPE_CHECK_BOX:this.engable=false;this.maintain_engage_when_tabbed_to=false;this.default_color=COLOR_TEXT_BUTTON;break;case TYPE_TITLE:this.maintain_engage_when_tabbed_to=false;this.default_color=COLOR_TEXT_BUTTON;break;case TYPE_CONSTANT_TEXT:this.default_color=COLOR_TEXT_CONSTANT;this.engable=false;break;default:this.default_color=COLOR_TEXT_DEFAULT;}
this.create();},set_label_position:function(label_position){this.label_position=label_position;},get_label_position:function(){return this.label_position;},set_label:function(label_value){this.label=label_value;},get_label:function(){if(!is_defined(this.label)){return'';}
return this.label;},set_default_color:function(default_color){this.default_color=default_color;this.update_text_color(this.text,this.default_color);},get_text:function(){if(this.type===TYPE_INPUT_PASSWORD){return this._hidden_text;}
return this.text;},get_position:function(){return this.object3D.position;},state_change_look_at:function(being_looked_at){if(being_looked_at){this.wireframe.material.color.setHex(COLOR_HIGHLIGHT);this.update_color(COLOR_TEXT_HIGHLIGHT);if(this.also_color_this_floating_text!==null){this.also_color_this_floating_text.update_text_color(this.also_color_this_floating_text.text,COLOR_TEXT_HIGHLIGHT);}}else{this.wireframe.material.color.setHex(this.original_border_color);this.update_color(this.default_color);if(this.also_color_this_floating_text!==null){this.also_color_this_floating_text.update_text_color(this.also_color_this_floating_text.text,this.default_color);}}},state_change_engage:function(being_engaged_with){if(being_engaged_with){if(this.type!==TYPE_BUTTON&&this.type!==TYPE_CHECK_BOX){CURRENT_PLAYER.engage();}else{this.being_engaged_with=false;CURRENT_PLAYER.disengage();}}else{CURRENT_PLAYER.disengage();}},get_text_length:function(){return this.dynamic_texture.getTextLength(this.text);},get_text_height:function(){return this.height;},clear_text:function(){this.dynamic_texture.clear();this.dynamic_texture.needsUpdate=true;},update_color:function(color){this.update_text_color(this.text,color);},update_text_color:function(text,color){this.text=text;switch(this.type){case TYPE_TITLE:case TYPE_CHECK_BOX:case TYPE_BUTTON:this.dynamic_texture.clear('black').drawText(this.text,this.width-this.get_text_length()/2,this.height+this.height/2,color,'black');break;default:this.dynamic_texture.clear('black').drawText(this.text,0,this.height,color);}
this.dynamic_texture.needsUpdate=true;},force_update_text:function(text){this.update_text_color(text,this.default_color);},update_text:function(text){if(this.text!==text){this.update_text_color(text,this.default_color);}},create:function(){this.object3D=new THREE.Object3D();if(this.type==TYPE_TITLE){this.height=32;}else{this.height=16;}
this.geometry=new THREE.PlaneGeometry(this.width,this.height);this.dynamic_texture=new THREEx.DynamicTexture(get_nearest_power_of_two_for_number(this.width*2),get_nearest_power_of_two_for_number(this.height*2));if(this.type==TYPE_TITLE){this.dynamic_texture.context.font='Bold 40px Arial';}else{this.dynamic_texture.context.font='20px Arial';}
this.dynamic_texture.texture.magFilter=THREE.NearestFilter;this.dynamic_texture.texture.minFilter=THREE.LinearMipMapLinearFilter;this.force_update_text(this.text);this.material=new THREE.MeshBasicMaterial({map:this.dynamic_texture.texture});this.material.transparent=false;this.material.side=THREE.FrontSide;this.mesh=new THREE.Mesh(this.geometry,this.material);var geo=new THREE.EdgesGeometry(this.mesh.geometry);var mat=new THREE.LineBasicMaterial({color:this.original_border_color,linewidth:3});this.wireframe=new THREE.LineSegments(geo,mat);this.mesh.add(this.wireframe);this.object3D.add(this.mesh);this.scene.add(this.object3D);},update_position:function(position_vector){this.object3D.position.x=position_vector.x;this.object3D.position.y=position_vector.y;this.object3D.position.z=position_vector.z;},update_look_at:function(look_at_position_vector){this.object3D.lookAt(look_at_position_vector);},update_position_and_look_at:function(position_vector,look_at_position){this.object3D.position.x=position_vector.x;this.object3D.position.y=position_vector.y;this.object3D.position.z=position_vector.z;this.object3D.lookAt(look_at_position);},add_character:function(character){this.text=this.text+character;this.force_update_text(this.text);},pop_character:function(){this.text=this.text.slice(0,-1);this.force_update_text(this.text);},parse_keycode:function(event){var keycode=event.keyCode;if(keycode===KEY_CODE_DELETE){if(this.text.length>0){this.pop_character();if(this.type===TYPE_INPUT_PASSWORD){this._hidden_text=this._hidden_text.slice(0,-1);}}
MANAGER_AUDIO.play_typing_sound();}else if(event.key.length===1){if(this.type===TYPE_INPUT_PASSWORD){this._hidden_text+=event.key;this.add_character('*');}else if(this.type===TYPE_INPUT_REGULAR){this.add_character(event.key);}
MANAGER_AUDIO.play_typing_sound();}},delete_self:function(){}};function Floating3DText(w,text,type,scene){this.__init__(w,text,type,scene);}
Floating3DText.prototype={_hidden_text:null,text:null,width:null,size:null,height:null,text_height:null,material:null,text_geometry:null,object3D:null,current_text_object:null,scene:null,wireframe:null,current_color:null,type:null,original_border_color:null,also_color_this_floating_text:null,__init__:function(w,text,type,scene){this.scene=scene;this.width=w;this.text=text;this._hidden_text='';this.original_border_color=0xFFC0CB;Interactive.call(this);Visibility.call(this);this.type=type;this.create_outline();this.create();},get_text:function(){if(this.type===TYPE_INPUT_PASSWORD){return this._hidden_text;}
return this.text;},state_change_look_at:function(being_looked_at){if(being_looked_at){this.update_just_color(COLOR_HIGHLIGHT);if(this.also_color_this_floating_text!==null){this.also_color_this_floating_text.update_just_color(COLOR_TEXT_HIGHLIGHT);}}else{this.update_just_color(COLOR_TEXT_DEFAULT);if(this.also_color_this_floating_text!==null){this.also_color_this_floating_text.update_just_color(COLOR_TEXT_DEFAULT);}}},state_change_engage:function(being_engaged_with){if(being_engaged_with){CURRENT_PLAYER.engage();}else{CURRENT_PLAYER.disengage();}},update_just_color:function(color_arg){this.material.color.setHex(color_arg);this.material.needsUpdate=true;},update_text_color:function(text,color_arg){if(this.current_color!==color_arg){this.material.color.setHex(color_arg);this.material.needsUpdate=true;}
if(this.current_text_object!==null){this.object3D.remove(this.current_text_object);this.current_text_object.geometry.dispose();this.current_text_object.material.dispose();}
if(this.text_geometry!==null){this.text_geometry.dispose();}
this.text_geometry=new THREE.TextGeometry(this.text,{size:this.size,height:this.text_height,curveSegments:2,font:GLOBAL_FONT});this.current_text=text;this.current_text_object=new THREE.Mesh(this.text_geometry,this.material);this.object3D.add(this.current_text_object);},update_text:function(text){if(this.current_text!==text){this.update_text_color(text,COLOR_TEXT_DEFAULT);}},create_outline:function(){this.material=new THREE.MeshLambertMaterial({color:COLOR_TEXT_DEFAULT});this.current_color=COLOR_TEXT_DEFAULT;this.material.needsUpdate=true;this.object3D=new THREE.Object3D();if(this.type===TYPE_SUPER_TITLE){this.height=32*4;}else if(this.type===TYPE_TITLE){this.height=32;}else{this.height=16;}
if(is_defined(this.scene)){this.scene.add(this.object3D);}},create:function(){if(this.type===TYPE_SUPER_TITLE){this.size=40*4;this.text_height=2*4;}else if(this.type===TYPE_TITLE){this.size=40;this.text_height=2;}else{this.size=20;this.text_height=1;}
this.update_text(this.text);this.material.side=THREE.FrontSide;},update_position_and_look_at:function(position_vector,look_at_position){this.object3D.position.x=position_vector.x;this.object3D.position.y=position_vector.y-this.height;this.object3D.position.z=position_vector.z;var look_at=new THREE.Vector3(look_at_position.x,look_at_position.y-this.height,look_at_position.z);this.object3D.lookAt(look_at);},add_character:function(character){this.text=this.text+character;this.update_text(this.text);},pop_character:function(){this.text=this.text.slice(0,-1);this.update_text(this.text);},parse_keycode:function(event){var keycode=event.keyCode;if(keycode==8){if(this.text.length>0){this.pop_character();if(this.type==TYPE_INPUT_PASSWORD){this._hidden_text=this._hidden_text.slice(0,-1);}}
MANAGER_AUDIO.play_typing_sound();}else if(event.key.length==1){if(this.type==TYPE_INPUT_PASSWORD){this._hidden_text+=event.key;this.add_character('*');}else if(this.type==TYPE_INPUT_REGULAR){this.add_character(event.key);}
MANAGER_AUDIO.play_typing_sound();}}}
function FloatingSlider(slider_title,current_value,minimum_value,maximum_value,width,position,normal,world){this.__init__(slider_title,current_value,minimum_value,maximum_value,width,position,normal,world);}
FloatingSlider.prototype={minimum_value:null,maximum_value:null,current_value:null,slider_increased:function(){if(this.current_value<this.maximum_value){this.current_value+=this.one_percent_value;}
if(this.current_value>this.maximum_value){this.current_value=this.maximum_value;}
this.update();},slider_decreased:function(){if(this.current_value>this.minimum_value){this.current_value-=this.one_percent_value;}
if(this.current_value<this.minimum_value){this.current_value=this.minimum_value;}
this.update();},update:function(){this.current_percentage=(this.current_value-this.minimum_value)/(this.maximum_value-this.minimum_value);this.current_value=(this.current_percentage*(this.maximum_value-this.minimum_value)+this.minimum_value);var current_value_text=round_to_n_decimal_places(this.current_value.toString(),3);this.current_value_text.update_text(current_value_text);this.current_value_text.update_position_and_look_at(this._get_current_position_on_slider(0,50,0),this._get_current_look_at_on_slider(0,50,0));this.slider_object.update_position_and_look_at(this._get_current_position_on_slider(this.normal.x*2,this.normal.y*2,this.normal.z*2),this._get_current_look_at_on_slider(this.normal.x*2,this.normal.y*2,this.normal.z*2));if(is_defined(MANAGER_WORLD)){CURRENT_PLAYER.look_at(this.slider_object.get_position());}
if(is_defined(this.value_changed_function)){this.value_changed_function(this.current_value);}},__init__:function(slider_title,current_value,minimum_value,maximum_value,width,position,normal,world){this.object3D=new THREE.Object3D();Interactive.call(this);Visibility.call(this);this.current_value=current_value;this.minimum_value=minimum_value;this.maximum_value=maximum_value;this.one_percent_value=(this.maximum_value-this.minimum_value)*0.01;this.width=width;this.position=position;this.normal=normal;this.world=world;this.slider_title=slider_title;this.left_right=new THREE.Vector3(0,1,0);this.left_right.cross(this.normal);this.left_right.normalize();this.wall=new PlaneAPI(this.width,20);this.object3D.add(this.wall.mesh);var current_percentage=(this.current_value-this.minimum_value)/(this.maximum_value-this.minimum_value);this.current_value_text=new Floating2DText(100,current_percentage.toString(),COLOR_TEXT_CONSTANT,this.world.scene);this.slider_object=new Floating2DText(12,'|||||||||',COLOR_TEXT_CONSTANT,this.world.scene);this.minimum_value_label=new Floating2DText(25,this.minimum_value.toString(),TYPE_CONSTANT_TEXT,this.world.scene);this.minimum_value_label.update_position_and_look_at(this.get_position_on_slider_based_off_percentage(0,0,-40,0),this.get_look_at_on_slider_based_off_percentage(0,0,-40,0));this.maximum_value_label=new Floating2DText(25,this.maximum_value.toString(),TYPE_CONSTANT_TEXT,this.world.scene);this.maximum_value_label.update_position_and_look_at(this.get_position_on_slider_based_off_percentage(1,0,-40,0),this.get_look_at_on_slider_based_off_percentage(1,0,-40,0));this.slider_floating_title=new Floating2DText(this.width/2.0,this.slider_title,TYPE_TITLE,this.world.scene);this.slider_floating_title.update_position_and_look_at(this.get_position_on_slider_based_off_percentage(.5,0,-40,0),this.get_look_at_on_slider_based_off_percentage(.5,0,-40,0));this.object3D.position.x=position.x;this.object3D.position.y=position.y;this.object3D.position.z=position.z;this.object3D.lookAt(new THREE.Vector3(position.x+normal.x,position.y+normal.y,position.z+normal.z));this.current_value_text.update_position_and_look_at(this._get_current_position_on_slider(0,40,0),this._get_current_look_at_on_slider(0,40,0));this.slider_object.update_position_and_look_at(this._get_current_position_on_slider(this.normal.x*2,this.normal.y*2,this.normal.z*2),this._get_current_look_at_on_slider(this.normal.x*2,this.normal.y*2,this.normal.z*2));this.slider_object.requires_mouse_x_movement=true;this.slider_object.bind_increase_and_decrease_functions(this.slider_increased.bind(this),this.slider_decreased.bind(this));this.world.scene.add(this.object3D);this.world.interactive_objects.push(this.slider_object);this.value_changed_function=null;this.update();},get_current_value:function(){return this.current_value;},get_position_on_slider_based_off_percentage:function(percentage,x_offset,y_offset,z_offset){var position=new THREE.Vector3(this.position.x,this.position.y,this.position.z);if(percentage<0.5){position.addScaledVector(this.left_right,(percentage*this.width)-(this.width*0.5));}else{position.addScaledVector(this.left_right,(percentage-0.5)*this.width);}
if(is_defined(x_offset)){position.x+=x_offset;}
if(is_defined(y_offset)){position.y+=y_offset;}
if(is_defined(z_offset)){position.z+=z_offset;}
return position;},get_look_at_on_slider_based_off_percentage:function(percentage,x_offset,y_offset,z_offset){var position=this.get_position_on_slider_based_off_percentage(percentage,x_offset,y_offset,z_offset);return new THREE.Vector3(position.x+this.normal.x,position.y+this.normal.y,position.z+this.normal.z);},_get_current_position_on_slider:function(x_offset,y_offset,z_offset){return this.get_position_on_slider_based_off_percentage((this.current_value-this.minimum_value)/(this.maximum_value-this.minimum_value),x_offset,y_offset,z_offset);},_get_current_look_at_on_slider:function(x_offset,y_offset,z_offset){var position=this._get_current_position_on_slider(x_offset,y_offset,z_offset);return new THREE.Vector3(position.x+this.normal.x,position.y+this.normal.y,position.z+this.normal.z);}}
function CheckBox(initial_state,scene){this.__init__(initial_state,scene);}
CheckBox.prototype={width:null,height:null,scene:null,floating_2d_text:null,checked:null,__init__:function(initial_state,scene){this.scene=scene;this.checked=initial_state;if(this.checked){this.text='X';}else{this.text='';}
this.width=16;this.height=16;this.floating_2d_text=new Floating2DText(16,this.text,TYPE_CHECK_BOX,this.scene);},update_position_and_look_at:function(position,look_at){this.floating_2d_text.update_position_and_look_at(position,look_at);},toggle:function(){this.checked=!this.checked;if(this.checked){this.floating_2d_text.update_text('X');}else{this.floating_2d_text.update_text(' ');}},status:function(){this.checked=this.floating_2d_text.get_text()==='X';return this.checked;},set_to_invisible:function(){this.floating_2d_text.set_to_invisible();},set_to_visible:function(){this.floating_2d_text.set_to_visible();},toggle_visibility:function(){this.floating_2d_text.toggle_visibility();}};function CreateEntity(entity_wall,entity_created_bind_function,position,normal,width,height){this.__init__(entity_wall,entity_created_bind_function,position,normal,width,height);}
const CELL_PHONE_CARRIERS={'No Value':'','AT&T':'number@txt.att.net','T-Mobile':'number@tmomail.net','Verizon':'number@vtext.com','Sprint':'number@pm.sprint.com','Virgin Mobile':'number@vmobl.com','Tracfone':'number@mmst5.tracfone.com','Metro PCS':'number@mymetropcs.com','Boost Mobile':'number@myboostmobile.com','Cricket':'number@mms.cricketwireless.net','Ptel':'number@ptel.com','Republic Wireless':'number@text.republicwireless.com','Google Fi':'number@msg.fi.google.com','Suncom':'number@tms.suncom.com','Ting':'number@message.ting.com','U.S. Cellular':'number@email.uscc.net','Consumer Cellular':'number@cingularme.com','C-Spire':'number@cspire1.com','Page Plus':'number@vtext.com'};CreateEntity.prototype={entity_created_bind_function:null,get_owner_sms_email:function(){var owner_entity=MANAGER_ENTITY.get_owner_entity();var owner_provider=owner_entity.get_value('owner_phone_carrier');var owner_phone_number=owner_entity.get_value('owner_phone_number');var owner_sms_address;for(var key in CELL_PHONE_CARRIERS){if(CELL_PHONE_CARRIERS.hasOwnProperty(key)){if(key===owner_provider){owner_sms_address=CELL_PHONE_CARRIERS[key].replace('number',owner_phone_number);}}}
return owner_sms_address;},entity_row_type_selected:function(selected_type){l('The selected type is : '+selected_type);this.create_entity_wall_title=this.create_entity_wall.add_floating_2d_text(this.entity_wall_width,'Create a New '+selected_type,TYPE_TITLE,0,2,1,0);this.entity_type_selector.set_to_invisible();this.add_create_entity_field(ENTITY_PROPERTY_NAME,'entity default name',false,true);this.add_create_entity_field(ENTITY_DEFAULT_PROPERTY_TYPE,selected_type,false,false);switch(selected_type){case ENTITY_TYPE_TEXT_REMINDER:this.add_create_entity_field(TEMP_PROPERTY_A,'message here',false,true);this.add_create_entity_field('PID :','to be filled out by the server',false,false);this.add_create_entity_field(TEMP_PROPERTY_B,'5',false,true);this.add_create_entity_field(TEMP_PROPERTY_C,this.get_owner_sms_email(),false,false);break;case ENTITY_TYPE_TASK:break;case ENTITY_TYPE_TIME:break;case ENTITY_TYPE_BASE:break;}
this.entity_type_selector.set_to_invisible();this.create_entity_wall.set_to_visible();},close_button_pressed:function(){this.create_entity_wall.set_to_invisible();this.clear_create_entity_fields();},add_attribute_prompt_close_button_pressed:function(){this.add_attribute_prompt.set_to_invisible();},add_attribute_button_pressed:function(){var position_update=new THREE.Vector3(this.add_attribute_button.get_position().x,this.add_attribute_button.get_position().y,this.add_attribute_button.get_position().z);position_update.addScaledVector(this.normal,10);this.add_attribute_prompt.update_position(position_update);this.add_attribute_prompt.set_to_visible();},save_entity_button_pressed:function(){var properties={};for(var i=0;i<this.create_entity_fields.length;i++){var entity_field_label=this.create_entity_fields[i][0].get_text();var entity_field_value=this.create_entity_fields[i][1].get_text();l('Printing the label and then value :');l(entity_field_label);l(entity_field_value);properties[entity_field_label]=entity_field_value;}
var new_entity=MANAGER_ENTITY.add_user_entity_from_entity_data(properties);new_entity.add_parent(this.entity_wall.get_wall_entity());this.entity_wall.add_entity(new_entity);this.create_entity_wall.set_to_invisible();this.clear_create_entity_fields();},__init__:function(entity_wall,entity_created_bind_function,position,normal,width,height){this.entity_wall=entity_wall;this.world=this.entity_wall.world;this.position=position;this.normal=normal;this.width=width;this.height=height;this.entity_created_bind_function=entity_created_bind_function;this.date_time_selector=null;var entity_type_selector_position=new THREE.Vector3(this.position.x+this.normal.x*14,this.position.y+this.normal.y*14,this.position.z+this.normal.z*14);this.entity_type_selector=new FloatingWall(this.width,this.height,entity_type_selector_position,this.normal,this.world);this.entity_type_selector.add_floating_2d_text(this.width,'Select Entity Type',TYPE_TITLE,0,4,1,0);var entity_type_row_index=4;for(var f=0;f<ENTITY_TYPE_ALL.length;f++){var entity_type_row=this.entity_type_selector.add_floating_2d_text(this.width,ENTITY_TYPE_ALL[f],TYPE_BUTTON,0,4,entity_type_row_index,0);entity_type_row_index+=1;this.entity_wall.world.interactive_objects.push(entity_type_row);entity_type_row.set_engage_function(this.entity_row_type_selected.bind(this,ENTITY_TYPE_ALL[f]));}
this.entity_type_selector.set_to_invisible();this.create_entity_fields=[];this.entity_wall_width=400;var entity_wall_height=512/2;var create_entity_wall_position=new THREE.Vector3(this.position.x+this.normal.x*28,this.position.y+this.normal.y*28,this.position.z+this.normal.z*28);this.create_entity_wall=new FloatingWall(this.entity_wall_width,entity_wall_height,create_entity_wall_position,this.normal,this.world);var create_entity_wall_close_button=this.create_entity_wall.add_close_button(3);create_entity_wall_close_button.set_engage_function(this.close_button_pressed.bind(this));this.add_attribute_button=this.create_entity_wall.add_floating_2d_text(this.entity_wall_width,'Add Attribute',TYPE_BUTTON,0,1,3,0);this.add_attribute_button.set_engage_function(this.add_attribute_button_pressed.bind(this));this.save_entity_button=this.create_entity_wall.add_floating_2d_text(this.entity_wall_width,'Save Entity',TYPE_BUTTON,0,2,0,(-entity_wall_height+16));this.save_entity_button.set_engage_function(this.save_entity_button_pressed.bind(this));this.create_entity_wall.set_to_invisible();var add_attribute_prompt_width=400;var temp_position=new THREE.Vector3(0,0,0);this.add_attribute_prompt=new FloatingWall(add_attribute_prompt_width,300,temp_position,this.normal,this.world);this.add_attribute_prompt_close_button=this.add_attribute_prompt.add_close_button(1);this.add_attribute_prompt_close_button.set_engage_function(this.add_attribute_prompt_close_button_pressed.bind(this));this.add_attribute_prompt.set_to_invisible();this.entity_wall.world.interactive_objects.push(this.add_attribute_button);this.entity_wall.world.interactive_objects.push(this.save_entity_button);this.entity_wall.world.interactive_objects.push(create_entity_wall_close_button);},set_to_visible:function(){this.entity_type_selector.set_to_visible();},remove_from_scene:function(){this.entity_type_selector.remove_from_scene();this.create_entity_wall.remove_from_scene();this.add_attribute_prompt.remove_from_scene();},add_create_entity_field:function(attribute_name,default_input,label_modifiable,input_modifiable){var y_offset=this.create_entity_fields.length*(16+2);var input_type_label=TYPE_INPUT_REGULAR;var input_type_input=TYPE_INPUT_REGULAR;if(is_defined(label_modifiable)){if(!label_modifiable){input_type_label=TYPE_CONSTANT_TEXT;}}
if(is_defined(input_modifiable)){if(!input_modifiable){input_type_input=TYPE_CONSTANT_TEXT;}}
var entity_wall_entity_name=this.create_entity_wall.add_floating_2d_text(this.entity_wall_width/2,attribute_name,input_type_label,this.entity_wall_width/-4,1,4,-y_offset);var entity_wall_entity_name_input=this.create_entity_wall.add_floating_2d_text(this.entity_wall_width/2,'',input_type_input,this.entity_wall_width/4,1,4,-y_offset);if(is_defined(default_input)){entity_wall_entity_name_input.update_text(default_input);}
this.entity_wall.world.interactive_objects.push(entity_wall_entity_name);this.entity_wall.world.interactive_objects.push(entity_wall_entity_name_input);this.create_entity_fields.push([entity_wall_entity_name,entity_wall_entity_name_input]);return[entity_wall_entity_name,entity_wall_entity_name_input];},clear_create_entity_fields:function(){for(var i=0;i<this.create_entity_fields.length;i++){var field_label=this.create_entity_fields[i][0];var field_input=this.create_entity_fields[i][1];var index_of_field_label=this.entity_wall.world.interactive_objects.indexOf(field_label);if(index_of_field_label>-1){this.entity_wall.world.interactive_objects.splice(index_of_field_label,1);}else{l('Warning : did not find the field label to remove.');l(field_label);}
var index_of_field_input=this.entity_wall.world.interactive_objects.indexOf(field_input);if(index_of_field_input>-1){this.entity_wall.world.interactive_objects.splice(index_of_field_input,1);}else{l('WARNING : did not find the field input to remove.');l(field_input);}
this.world.remove_from_scene(field_label);this.world.remove_from_scene(field_input);}
this.world.remove_from_scene(this.create_entity_wall_title);this.create_entity_fields.length=0;}};function EntityWall(position,world,entity){this.__init__(position,world,entity);}
EntityWall.prototype={position:null,look_at:null,world:null,scene:null,normal:null,depth_start:null,depth:null,width:null,height:null,title_text:null,title:null,self_entity:null,create_or_update_self_wall_entity:function(){var save_data={};save_data[ENTITY_PROPERTY_NAME]=this.title.get_text();save_data[ENTITY_PROPERTY_POSITION]='['+this.position.x+','+this.position.y+','+this.position.z+']';save_data[ENTITY_PROPERTY_LOOK_AT]='['+this.look_at.x+','+this.look_at.y+','+this.look_at.z+']';if(!is_defined(this.self_entity)){save_data[ENTITY_DEFAULT_PROPERTY_TYPE]=ENTITY_TYPE_WALL;this.self_entity=new Entity(save_data);}else{this.self_entity.update_values(save_data);}},get_wall_entity:function(){if(!is_defined(this.self_entity)){l('WARNING : self entity is null');}
return this.self_entity;},set_entity:function(entity){this.self_entity=entity;},delete_entity_wall_pressed:function(){this.are_you_sure.set_to_visible();},perform_delete_entity_wall:function(){MANAGER_ENTITY.delete_entity(this.self_entity);this.world.remove_from_interactive_then_scene(this.title);this.world.remove_from_interactive_then_scene(this.create_entity_button);this.world.remove_from_interactive_then_scene(this.make_entity_wall_public_button);this.world.remove_from_interactive_then_scene(this.delete_entity_wall_button);this.are_you_sure.remove_from_scene();this.entities_display_wall.remove_from_scene();this.create_entity_wall.remove_from_scene();this.world.remove_from_scene(this.object3D);},create_entity_button_pressed:function(){this.create_entity_wall.set_to_visible();},are_you_sure_close_button_pressed:function(){this.are_you_sure.set_to_invisible();},entity_editor_close_button_pressed:function(){this.current_entity_editor.remove_from_scene();},entity_editor_save_changes_button_pressed:function(){var save_data={};var labels=[];var values=[];var floating_texts=this.current_entity_editor.get_all_floating_2d_texts();var i;for(i=0;i<floating_texts.length;i++){var current_label_position=floating_texts[i].get_label_position();var current_label=floating_texts[i].get_label();if(current_label_position>-1){if(current_label==='l'){labels.push([current_label_position,floating_texts[i].get_text()]);}else{values.push([current_label_position,floating_texts[i].get_text()]);}}}
for(i=0;i<labels.length;i++){for(var j=0;j<values.length;j++){if(labels[i][0]===values[j][0]){save_data[labels[i][1]]=values[j][1];}}}
var entity_id=save_data[ENTITY_DEFAULT_PROPERTY_RELATIVE_ID];var entity=MANAGER_ENTITY.get_entity_by_id(entity_id);entity.update_values(save_data);this.current_floating_entity_row.update_text(save_data[ENTITY_PROPERTY_NAME]);if(save_data[ENTITY_DEFAULT_PROPERTY_TYPE]===ENTITY_TYPE_TASK){if(save_data[ENTITY_PROPERTY_COMPLETED]==='True'){this.current_floating_entity_row.set_default_color(COLOR_TEXT_GREEN);}else{this.current_floating_entity_row.set_default_color(COLOR_TEXT_RED);}}
MANAGER_ENTITY.update_server_and_database();this.current_entity_editor.remove_from_scene();},edit_entity_pressed:function(){l('EDIT THE PRESSED FLOATING ENTITY!!!!');for(var i=0;i<this.floating_row_to_entity_list.length;i++){if(this.floating_row_to_entity_list[i][0]===this.world.currently_looked_at_object){l('EDIT THE FOLLOWING ENTITIY:');var current_entity=this.floating_row_to_entity_list[i][1];l(current_entity);var position=new THREE.Vector3(this.world.currently_looked_at_object.get_position().x,this.world.currently_looked_at_object.get_position().y,this.world.currently_looked_at_object.get_position().z);position.addScaledVector(this.normal,10);var key_values=get_key_value_list_from_json_dictionary(current_entity.get_all_properties());var current_entity_editor_height=(key_values.length+2)*(16+2);this.current_entity_editor=new FloatingWall(512,current_entity_editor_height,position,this.normal,this.world);this.current_floating_entity_row=this.floating_row_to_entity_list[i][0];var entity_editor_close_button=this.current_entity_editor.add_close_button(1);this.world.interactive_objects.push(entity_editor_close_button);for(var p=0;p<key_values.length;p++){var property_name=this.current_entity_editor.add_floating_2d_text(512/3,key_values[p][0],TYPE_INPUT_REGULAR,-512/3,2,p,0);property_name.set_label('l');property_name.set_label_position(p);var property_value=this.current_entity_editor.add_floating_2d_text((512/3)*2,key_values[p][1],TYPE_INPUT_REGULAR,512/3-(512/6),2,p,0);property_value.set_label('v');property_value.set_label_position(p);if(MANAGER_ENTITY.is_property_user_modifiable(property_name.get_text())){this.world.interactive_objects.push(property_name);this.world.interactive_objects.push(property_value);}else{this.world.interactive_objects.push(property_name);property_name.engable=false;this.world.interactive_objects.push(property_value);property_name.engable=false;property_name.set_default_color(COLOR_TEXT_CONSTANT);property_value.set_default_color(COLOR_TEXT_CONSTANT);}}
var edit_entity_save_changes_button=this.current_entity_editor.add_floating_2d_text(512,'save changes',TYPE_BUTTON,0,2,key_values.length+1,0);this.world.interactive_objects.push(edit_entity_save_changes_button);edit_entity_save_changes_button.set_engage_function(this.entity_editor_save_changes_button_pressed.bind(this));entity_editor_close_button.set_engage_function(this.entity_editor_close_button_pressed.bind(this));}}},entity_was_created:function(entity){l('The following entity was just created!');l(entity);},make_entity_wall_public_button_pressed:function(){var save_data={};save_data.public='true';save_data.owner=ENTITY_OWNER.get_username();this.self_entity.update_values(save_data);},__init__:function(position,world,entity){this.current_entity_editor=null;this.position=position;this.look_at=new THREE.Vector3(0,this.position.y,0);this.normal=new THREE.Vector3(this.look_at.x-this.position.x,this.look_at.y-this.position.y,this.look_at.z-this.position.z);this.normal.normalize();this.depth=new THREE.Vector3(this.normal.x*20,this.normal.y*20,this.normal.z*20);this.depth_start=new THREE.Vector3(this.normal.x*2,this.normal.y*2,this.normal.z*2);this.world=world;this.scene=this.world.scene;this.object3D=new THREE.Object3D();this.object3D.position.x=position.x;this.object3D.position.y=position.y;this.object3D.position.z=position.z;this.object3D.lookAt(new THREE.Vector3(this.look_at.x,this.look_at.y,this.look_at.z));this.width=512;this.height=1024;this.wall=new PlaneAPI(this.width,this.height);this.title=new Floating2DText(this.width,'Default Group Name',TYPE_INPUT_REGULAR,this.scene);this.title.update_position_and_look_at(this.get_position_for_row(0,this.get_y_position_for_row(0),0,1),this.get_look_at_for_row(0,this.get_y_position_for_row(0),0,1));var create_entity_position=this.get_position_for_row(0,this.get_y_position_for_row(1),0,1);this.create_entity_button=new Floating2DText(this.width,'Create Entity',TYPE_BUTTON,this.scene);this.create_entity_button.update_position_and_look_at(create_entity_position,this.get_look_at_for_row(0,this.get_y_position_for_row(1),0,1));this.create_entity_button.set_engage_function(this.create_entity_button_pressed.bind(this));this.entities=[];this.entities_display_wall_width=this.width*0.9;this.entities_display_wall_height=this.height*0.75;var entities_display_wall_position=this.get_position_for_row(0,-this.height/2,0,2);this.entities_display_wall=new FloatingWall(this.entities_display_wall_width,this.entities_display_wall_height,entities_display_wall_position,this.normal,this.world);this.delete_entity_wall_button=new Floating2DText(this.width,'Delete Entity Wall',TYPE_BUTTON,this.scene);this.delete_entity_wall_button.set_default_color(COLOR_TEXT_RED);this.delete_entity_wall_button.update_position_and_look_at(this.get_position_for_row(0,this.title.height-this.height,0,1),this.get_look_at_for_row(0,this.title.height-this.height,0,1));this.delete_entity_wall_button.set_engage_function(this.delete_entity_wall_pressed.bind(this));this.make_entity_wall_public_button=new Floating2DText(this.width,'Make Entity Wall Public',TYPE_BUTTON,this.scene);this.make_entity_wall_public_button.set_default_color(COLOR_TEXT_BUTTON);this.make_entity_wall_public_button.update_position_and_look_at(this.get_position_for_row(0,this.title.height*2-this.height,0,1),this.get_look_at_for_row(0,this.title.height*2-this.height,0,1));this.make_entity_wall_public_button.set_engage_function(this.make_entity_wall_public_button_pressed.bind(this));var entity_wall_position=new THREE.Vector3(this.create_entity_button.get_position().x+this.normal.x*3,this.create_entity_button.get_position().y+this.normal.y*3,this.create_entity_button.get_position().z+this.normal.z*3);this.create_entity_wall=new CreateEntity(this,this.entity_was_created.bind(this),entity_wall_position,this.normal,512/2,(ENTITY_TYPE_ALL.length+4)*16);var are_you_sure_width=300;var are_you_sure_position=this.get_position_for_row(0,this.title.height-this.height,0,3);this.are_you_sure=new FloatingWall(are_you_sure_width,100,are_you_sure_position,this.normal,this.world);var prompt=this.are_you_sure.add_floating_2d_text(are_you_sure_width/2,'Are you sure?',TYPE_TITLE,-1.0*(are_you_sure_width/4.0),2,1,0);this.are_you_sure.add_object_to_remove_later(prompt);var are_you_sure_close_button=this.are_you_sure.add_close_button(1);are_you_sure_close_button.set_engage_function(this.are_you_sure_close_button_pressed.bind(this));var yes_button=this.are_you_sure.add_floating_2d_text(are_you_sure_width/4,'Yes',TYPE_BUTTON,-1.0*(are_you_sure_width/4.0),1,3,0);this.world.interactive_objects.push(yes_button);yes_button.set_engage_function(this.perform_delete_entity_wall.bind(this));var no_button=this.are_you_sure.add_floating_2d_text(are_you_sure_width/4,'No',TYPE_BUTTON,(are_you_sure_width/4.0),1,3,0);this.world.interactive_objects.push(no_button);no_button.set_engage_function(this.are_you_sure_close_button_pressed.bind(this));this.are_you_sure.set_to_invisible();this.world.interactive_objects.push(this.title);this.world.interactive_objects.push(this.create_entity_button);this.world.interactive_objects.push(this.make_entity_wall_public_button);this.world.interactive_objects.push(this.delete_entity_wall_button);var extra_interactives=this.are_you_sure.get_all_interactive_objects();for(var d=0;d<extra_interactives.length;d++){this.world.interactive_objects.push(extra_interactives[d]);}
this.title.set_next_tab_target(this.create_entity_button);this.create_entity_button.set_next_tab_target(this.make_entity_wall_public_button);this.make_entity_wall_public_button.set_next_tab_target(this.delete_entity_wall_button);this.delete_entity_wall_button.set_next_tab_target(this.title);this.object3D.add(this.wall.mesh);this.scene.add(this.object3D);this.floating_row_to_entity_list=[];if(is_defined(entity)){this.self_entity=entity;}else{this.create_or_update_self_wall_entity();}},update_title:function(title){this.title.update_text(title);var save_data={};save_data[ENTITY_PROPERTY_NAME]=this.title.get_text();this.self_entity.update_values(save_data);},add_entity:function(entity){var y_offset=-(this.entities.length)*(16+2);var floating_row=this.entities_display_wall.add_floating_2d_text(this.entities_display_wall_width,entity.name,TYPE_BUTTON,0,4,0,y_offset);if(entity.get_value(ENTITY_DEFAULT_PROPERTY_TYPE)===ENTITY_TYPE_TASK){if(entity.get_value(ENTITY_PROPERTY_COMPLETED)==='False'){floating_row.set_default_color(COLOR_TEXT_RED);var floating_row_button=this.entities_display_wall.add_floating_2d_text(this.entities_display_wall_width/4,'mark as completed',TYPE_BUTTON,this.entities_display_wall_width*.375,5,0,y_offset);}else{floating_row.set_default_color(COLOR_TEXT_GREEN);}}
this.world.interactive_objects.push(floating_row);floating_row.set_engage_function(this.edit_entity_pressed.bind(this));this.entities.push(entity);this.floating_row_to_entity_list.push([floating_row,entity]);},get_y_position_for_row:function(y_index){return(-16.0/2.0)*(1+(2*y_index));},get_position_for_row:function(x_offset,y_offset,z_offset,depth){var p=new THREE.Vector3(this.object3D.position.x+x_offset,this.object3D.position.y+this.height/2+y_offset,this.object3D.position.z);p.addScaledVector(this.depth_start,depth);return p;},get_look_at_for_row:function(x_offset,y_offset,z_offset,depth){var la=new THREE.Vector3(this.look_at.x+x_offset,this.look_at.y+this.height/2+y_offset,this.look_at.z);la.addScaledVector(this.depth_start,depth);return la;}};function World(planet_name){this.planet_position=null;this.planet_name=planet_name;this.currently_looked_at_object=null;this.raycaster=null;this.current_world=false;this.scene=new THREE.Scene();this.default_tab_target=null;this.interactive_objects=[];this.add_to_scene=function(object){this.scene.add(object);};this.remove_from_scene=function(object){this.scene.remove(object);if(object.hasOwnProperty('object3D')){this.scene.remove(object.object3D);}};this.remove_from_interactive_then_scene=function(object_to_remove){var index_to_remove=-1;for(var i=0;i<this.interactive_objects.length;i++){if(this.interactive_objects[i]===object_to_remove){index_to_remove=i;break;}}
if(index_to_remove!==-1){this.interactive_objects.splice(index_to_remove,1);}
this.remove_from_scene(object_to_remove.object3D);};this.set_player=function(){this.raycaster=new THREE.Raycaster(CURRENT_PLAYER.fps_controls.get_position(),CURRENT_PLAYER.fps_controls.get_direction());this.currently_looked_at_object=null;};this.add_interactive_object=function(interactive_object){this.interactive_objects.push(interactive_object);};this.set_cursor_position=function(position){this.cursor.position.x=position.x;this.cursor.position.y=position.y;this.cursor.position.z=position.z;};this.update_interactive_objects=function(){this.raycaster.set(CURRENT_PLAYER.fps_controls.get_position(),CURRENT_PLAYER.fps_controls.get_direction());var match_was_found=false;var closest_object=null;var closest_data_thing=null;var final_point=null;var smallest_distance=99999;var interactive_index=-1;for(var i=0;i<this.interactive_objects.length;i++){var current_smallest_distance=9999;var intersections=this.raycaster.intersectObject(this.interactive_objects[i].object3D,true);if(intersections.length>0){for(var d=0;d<intersections.length;d++){if(intersections[d].distance<current_smallest_distance){current_smallest_distance=intersections[d].distance;closest_object=intersections[d].object;closest_data_thing=intersections[d];}}
for(var m=0;m<this.interactive_objects.length;m++){var has_match=false;if(this.interactive_objects[m].mesh.hasOwnProperty('wireframe')){if(this.interactive_objects[m].wireframe.uuid===closest_object.uuid){has_match=true;}}
if(this.interactive_objects[m].mesh.uuid===closest_object.uuid||this.interactive_objects[m].geometry.uuid===closest_object.uuid){has_match=true;}
if(has_match){if(current_smallest_distance<smallest_distance){smallest_distance=current_smallest_distance;interactive_index=m;final_point=closest_data_thing;}}}}}
if(interactive_index!==-1){if(this.currently_looked_at_object!==this.interactive_objects[interactive_index]){if(this.currently_looked_at_object!==null){this.currently_looked_at_object.look_away();}
this.currently_looked_at_object=this.interactive_objects[interactive_index];this.currently_looked_at_object.look_at();}
this.set_cursor_position(final_point.point);match_was_found=true;}else{this.set_cursor_position(-5000,-5000,-5000);}
if(!match_was_found&&this.currently_looked_at_object!==null){this.currently_looked_at_object.look_away();this.currently_looked_at_object=null;}};this.tab_to_next_interactive_object=function(){if(this.currently_looked_at_object!==null){if(this.currently_looked_at_object.is_engaged()){this.currently_looked_at_object.disengage();this.currently_looked_at_object.look_away();this.currently_looked_at_object=this.currently_looked_at_object.next_tab_target;this.currently_looked_at_object.look_at();if(this.currently_looked_at_object.maintain_engage_when_tabbed_to){this.currently_looked_at_object.engage();}else{CURRENT_PLAYER.enable_controls();}}else{this.currently_looked_at_object.look_away();this.currently_looked_at_object=this.currently_looked_at_object.next_tab_target;this.currently_looked_at_object.look_at();}
CURRENT_PLAYER.look_at(this.currently_looked_at_object.object3D.position);}else if(is_defined(this.default_tab_target)){this.currently_looked_at_object=this.default_tab_target;CURRENT_PLAYER.look_at(this.currently_looked_at_object.object3D.position);this.currently_looked_at_object.look_at();}};this.single_left_click=function(){if(this.currently_looked_at_object!==null){if(!this.currently_looked_at_object.is_engaged()){this.currently_looked_at_object.engage();}}};this.single_middle_click=function(){};this.single_right_click=function(){if(this.currently_looked_at_object!==null){if(this.currently_looked_at_object.is_engaged()){this.currently_looked_at_object.disengage();CURRENT_PLAYER.enable_controls();}}};this.key_down_event_for_interactive_objects=function(event){if(event.keyCode===KEY_CODE_BACK_SLASH){if(this.currently_looked_at_object!==null){if(this.currently_looked_at_object.is_engaged()){this.currently_looked_at_object.disengage();CURRENT_PLAYER.enable_controls();}}}else if(event.keyCode===KEY_CODE_TAB){this.tab_to_next_interactive_object();event.stopPropagation();}else if(this.currently_looked_at_object!==null){}
if(this.currently_looked_at_object!==null){if(this.currently_looked_at_object.is_engaged()||!this.currently_looked_at_object.needs_engage_for_parsing_input){this.currently_looked_at_object.parse_keycode(event);}}
if(event.keyCode===KEY_CODE_E||event.keyCode===KEY_CODE_ENTER){if(this.currently_looked_at_object!==null){if(!this.currently_looked_at_object.is_engaged()){this.currently_looked_at_object.engage();}}}
event.preventDefault();};this.set_default_tab_target=function(default_tab_target){this.default_tab_target=default_tab_target;};var grid=new vg.HexGrid({cellSize:100});grid.generate({size:10});var board=new vg.Board(grid);board.generateTilemap({cellSize:100,tileScale:0.99});this.add_to_scene(board.group);var light3=new THREE.PointLight(0xccffcc,.8,0);light3.position.set(5,100,5);this.add_to_scene(light3);var lightr=new THREE.PointLight(0xff8579,.9,0);lightr.position.set(1000,100,0);this.add_to_scene(lightr);var lightg=new THREE.PointLight(0xb1ff90,.9,0);lightg.position.set(0,100,1000);this.add_to_scene(lightg);var lightb=new THREE.PointLight(0x84b5ff,.9,0);lightb.position.set(500,100,500);this.add_to_scene(lightb);var light=new THREE.AmbientLight(0xffffff,.2);this.add_to_scene(light);var sphereGeom=new THREE.SphereGeometry(4,25,25);var blueMaterial=new THREE.MeshBasicMaterial({color:0xa6fff2,transparent:true,opacity:0.5});this.cursor=new THREE.Mesh(sphereGeom,blueMaterial);this.add_to_scene(this.cursor);this.add_sky_box=function(skybox_material){var skybox_geometry=new THREE.BoxGeometry(14000,14000,14000);var skybox_cube=new THREE.Mesh(skybox_geometry,skybox_material);skybox_cube.position.set(0,0,0);this.add_to_scene(skybox_cube);};}
function WorldManager(){this.__init__();}
function Planet(world,x,y,z){this.__init__(world,x,y,z);}
Planet.prototype={geometry:null,material:null,mesh:null,object3D:null,__init__:function(world,x,y,z){this.world=world;this.planet_title=new Floating3DText(600,world.planet_name,TYPE_SUPER_TITLE);this.planet_title.update_position_and_look_at(new THREE.Vector3(x,y-500,z),new THREE.Vector3(0,0,0));this.geometry=new THREE.DodecahedronGeometry(200,2);this.planet_color=0x8effcb;this.material=new THREE.MeshBasicMaterial({color:0x8effcb,side:THREE.DoubleSide});this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.position.set(x,y,z);this.mesh.material.color.setHex(COLOR_TEXT_PLANET);this.planet_title.update_just_color(COLOR_TEXT_PLANET);this.object3D=new THREE.Object3D();this.object3D.add(this.mesh);Interactive.call(this);Visibility.call(this);},add_this_planet_to_world:function(world){world.add_to_scene(this.object3D);world.add_interactive_object(this);world.add_to_scene(this.planet_title.object3D);},state_change_look_at:function(being_looked_at){if(being_looked_at){this.mesh.material.color.setHex(COLOR_HIGHLIGHT);this.mesh.material.needsUpdate=true;this.planet_title.update_just_color(COLOR_HIGHLIGHT);}else{this.mesh.material.color.setHex(COLOR_TEXT_PLANET);this.mesh.material.needsUpdate=true;this.planet_title.update_just_color(COLOR_TEXT_PLANET);}},state_change_engage:function(being_engaged_with){if(being_engaged_with){MANAGER_WORLD.set_current_world(this.world);this.being_engaged_with=false;}else{CURRENT_PLAYER.disengage();}}};WorldManager.prototype={previous_world:null,current_world:null,current_scene:null,world_login:null,world_home:null,world_settings:null,number_of_sky_box_textures_loaded:null,sky_box_textures:null,__init__:function(){this.world_login=new LoginWorld();this.world_home=new HomeWorld();this.world_settings=new SettingsWorld();this.sky_box_textures=[];this.final_textures=[];this.number_of_sky_box_textures_loaded=0;this.load_sky_box();this.planet_settings=new Planet(this.world_settings,4000,4000,4000);this.planet_home=new Planet(this.world_home,4000,4000,-4000);this.planet_login=new Planet(this.world_login,-4000,4000,4000);this.planet_settings.add_this_planet_to_world(this.world_home);this.planet_home.add_this_planet_to_world(this.world_settings);},set_player_and_current_world:function(current_world){this.world_login.set_player();this.world_home.set_player();this.world_settings.set_player();this.set_current_world(current_world);},update_current_scene:function(){this.current_world.update();},set_current_world:function(world){if(this.current_world!==null){this.current_world.remove_from_scene(CURRENT_PLAYER.fps_controls.yaw);this.current_world.exit_world();this.current_world.current_world=false;this.previous_world=this.current_world;}
this.current_world=world;this.current_world.current_world=true;this.current_scene=this.current_world.scene;this.current_world.add_to_scene(CURRENT_PLAYER.fps_controls.yaw);this.current_world.enter_world();},key_down_event:function(event){this.current_world.key_down_event(event);},add_to_current_scene:function(object){this.current_world.add(object);},add_to_all_scenes:function(object){this.world_login.add_to_scene(object);this.world_home.add_to_scene(object);},create_sky_boxes:function(){for(var i=0;i<6;i++){this.final_textures.push(null);for(var j=0;j<6;j++){if(this.sky_box_textures[j][1]===i){this.final_textures[i]=this.sky_box_textures[j][0];}}}
this.world_login.add_sky_box(this.final_textures);this.world_home.add_sky_box(this.final_textures);this.world_settings.add_sky_box(this.final_textures);},load_sky_box:function(){this.load_specific_texture('/home/git_repos/quasar_source/quasar_source_code/quasar_site_django/static/assets/skybox/skybox_texture_front.jpg');this.load_specific_texture('/home/git_repos/quasar_source/quasar_source_code/quasar_site_django/static/assets/skybox/skybox_texture_back.jpg');this.load_specific_texture('/home/git_repos/quasar_source/quasar_source_code/quasar_site_django/static/assets/skybox/skybox_texture_top.jpg');this.load_specific_texture('/home/git_repos/quasar_source/quasar_source_code/quasar_site_django/static/assets/skybox/skybox_texture_bottom.jpg');this.load_specific_texture('/home/git_repos/quasar_source/quasar_source_code/quasar_site_django/static/assets/skybox/skybox_texture_right.jpg');this.load_specific_texture('/home/git_repos/quasar_source/quasar_source_code/quasar_site_django/static/assets/skybox/skybox_texture_left.jpg');},texture_was_loaded:function(){this.number_of_sky_box_textures_loaded+=1;if(this.number_of_sky_box_textures_loaded==6){this.create_sky_boxes();}},load_specific_texture:function(texture_url){var position=-1;if(texture_url.includes('front')){position=0;}else if(texture_url.includes('back')){position=1;}else if(texture_url.includes('top')){position=2;}else if(texture_url.includes('bottom')){position=3;}else if(texture_url.includes('right')){position=4;}else if(texture_url.includes('left')){position=5;}
new THREE.TextureLoader().load(texture_url,function(texture){this.sky_box_textures.push([new THREE.MeshBasicMaterial({map:texture,side:THREE.DoubleSide,transparent:true,opacity:0.45}),position]);l('loaded texture!');this.texture_was_loaded();}.bind(this),function(xhr){l((xhr.loaded/xhr.total*100)+'% loaded for texture file.');},function(xhr){l(xhr);});}};function LoginWorld(){this.__init__();}
const LOGIN_X=0;LoginWorld.prototype={create_username:null,post_create_account:null,post_login:null,current_world:null,attempted_username:null,attempted_password:null,login_username_character_change:function(){},login_button_clicked:function(){var error=false;var error_message='';var login_username_text=this.login_username.get_input_text();var login_password_text=this.login_password.get_input_text();if(login_username_text.length<4){error=true;error_message='Username must be at least 4 characters.';}
if(!error){if(login_password_text.length<4){error=true;error_message='Passwords are at least 4 characters!';}}
if(!error){GUI_TYPING_INTERFACE.add_server_message('Sending login request to server...');this.attempted_username=login_username_text;this.attempted_password=login_password_text;var data={};data[ENTITY_PROPERTY_USERNAME]=login_username_text;data[ENTITY_PROPERTY_PASSWORD]=login_password_text;this.post_login.perform_post(data,this.login_button_event.bind(this));}else{GUI_TYPING_INTERFACE.add_server_message('Error : '+error_message);}},login_button_event:function(data){if(data===SERVER_REPLY_GENERIC_YES){GUI_TYPING_INTERFACE.add_server_message('Logged in!');if(this.remember_username_checkbox.checked){MANAGER_COOKIES.set(COOKIE_REMEMBERED_USERNAME,this.attempted_username);}
CURRENT_PLAYER.login(this.attempted_username,this.attempted_password);}else{GUI_TYPING_INTERFACE.add_server_message('Error : '+data);}},create_account_button_clicked:function(){var error=false;var error_message='';var email_text=this.create_email.get_input_text();var username_text=this.create_username.get_input_text();var password_text=this.create_password.get_input_text();this.attempted_password=this.create_password.get_input_text();var password_repeat_text=this.create_repeat_password.get_input_text();if(!is_email_valid(email_text)){error=true;error_message='invalid email format';}
if(!error){if(username_text.length<4){error=true;error_message='username text length < 4';}}
if(!error){if(password_text.length<4||password_text!==password_repeat_text){error=true;if(password_text.length<4){error_message='password length < 4';}else{error_message='passwords do not match';}}}
if(!error){GUI_TYPING_INTERFACE.add_server_message('Sending create account request to server...');var data={};data[ENTITY_PROPERTY_USERNAME]=username_text;data[ENTITY_PROPERTY_PASSWORD]=password_text;data[ENTITY_PROPERTY_EMAIL]=email_text;this.post_create_account.perform_post(data,this.create_account_button_event.bind(this));}else{GUI_TYPING_INTERFACE.add_server_message('Error : '+error_message);}},create_account_button_event:function(data){if(data===SERVER_REPLY_GENERIC_YES){GUI_TYPING_INTERFACE.add_server_message('Account created! Now sending login request to server!');this.attempted_username=this.create_username.get_input_text();this.attempted_password=this.create_password.get_input_text();var local_data={};local_data[ENTITY_PROPERTY_USERNAME]=this.attempted_username;local_data[ENTITY_PROPERTY_PASSWORD]=this.attempted_password;this.post_login.perform_post(local_data,this.login_button_event.bind(this));}else{GUI_TYPING_INTERFACE.add_server_message('Error : '+data);}},remember_username_clicked:function(){this.remember_username_checkbox.toggle();if(this.remember_username_checkbox.status()){MANAGER_COOKIES.set(COOKIE_SHOULD_REMEMBER_USERNAME,'true');}else{MANAGER_COOKIES.set(COOKIE_SHOULD_REMEMBER_USERNAME,'false');}},__init__:function(){this.post_create_account=new PostHelper(POST_URL_CREATE_ACCOUNT);this.post_login=new PostHelper(POST_URL_LOGIN);World.call(this,'LoginWorld');var global_y_offset=50;var login_width=150;this.login_title=new Floating3DText(login_width,'Login',TYPE_TITLE,this.scene);this.login_title.update_position_and_look_at(new THREE.Vector3(LOGIN_X,200+global_y_offset,40),new THREE.Vector3(LOGIN_X,200+global_y_offset,55));this.login_username=new Floating2DLabelInput(login_width,'Username :',TYPE_INPUT_REGULAR,this.scene);this.login_username.update_position(0,100+global_y_offset,45);this.login_password=new Floating2DLabelInput(login_width,'Password :',TYPE_INPUT_PASSWORD,this.scene);this.login_password.update_position(0,75+global_y_offset,45);var remember_me_width=75;this.remember_username_text=new Floating2DText(remember_me_width,'remember me c:',TYPE_INPUT_REGULAR,this.scene);this.remember_username_text.update_position_and_look_at(new THREE.Vector3(remember_me_width/2,50+global_y_offset,45),new THREE.Vector3(remember_me_width/2,50+global_y_offset,45));this.remember_username_checkbox=new CheckBox(true,this.scene);this.remember_username_checkbox.update_position_and_look_at(new THREE.Vector3(150-16/2,50+global_y_offset,45),new THREE.Vector3(150-16/2,50+global_y_offset,45));this.remember_username_checkbox.floating_2d_text.set_engage_function(this.remember_username_clicked.bind(this));this.login_button=new Floating2DText(login_width,'Login',TYPE_BUTTON,this.scene);this.login_button.update_position_and_look_at(new THREE.Vector3(login_width/2,25+global_y_offset,45),new THREE.Vector3(login_width/2,25+global_y_offset,55));this.login_button.set_engage_function(this.login_button_clicked.bind(this));var create_width=150;this.create_account_title=new Floating3DText(create_width,'Create\nAccount',TYPE_TITLE,this.scene);this.create_account_title.update_position_and_look_at(new THREE.Vector3(200,225+global_y_offset,40),new THREE.Vector3(200,225+global_y_offset,55));this.create_username=new Floating2DLabelInput(create_width,'Username :',TYPE_INPUT_REGULAR,this.scene);this.create_username.update_position(200,100+global_y_offset,45);if(!is_defined(MANAGER_COOKIES.get(COOKIE_SHOULD_REMEMBER_USERNAME))){MANAGER_COOKIES.set(COOKIE_SHOULD_REMEMBER_USERNAME,this.remember_username_checkbox.status());}
this.create_email=new Floating2DLabelInput(create_width,'Email :',TYPE_INPUT_REGULAR,this.scene);this.create_email.update_position(200,75+global_y_offset,45);this.create_password=new Floating2DLabelInput(create_width,'Password :',TYPE_INPUT_PASSWORD,this.scene);this.create_password.update_position(200,50+global_y_offset,45);this.create_repeat_password=new Floating2DLabelInput(create_width,'Repeat Password :',TYPE_INPUT_PASSWORD,this.scene);this.create_repeat_password.update_position(200,25+global_y_offset,45);this.create_account_button=new Floating2DText(create_width,'Create Account',TYPE_BUTTON,this.scene);this.create_account_button.update_position_and_look_at(new THREE.Vector3(200+create_width/2,global_y_offset,45),new THREE.Vector3(200+create_width/2,0+global_y_offset,46));this.create_account_button.set_engage_function(this.create_account_button_clicked.bind(this));this.interactive_objects=[this.login_button,this.create_account_button,this.login_username.floating_input,this.login_password.floating_input,this.create_username.floating_input,this.create_email.floating_input,this.create_password.floating_input,this.create_repeat_password.floating_input,this.remember_username_checkbox.floating_2d_text];this.login_username.floating_input.set_next_tab_target(this.login_password.floating_input);this.login_password.floating_input.set_next_tab_target(this.remember_username_checkbox.floating_2d_text);this.remember_username_checkbox.floating_2d_text.set_next_tab_target(this.login_button);this.login_button.set_next_tab_target(this.create_username.floating_input);this.create_username.floating_input.set_next_tab_target(this.create_email.floating_input);this.create_email.floating_input.set_next_tab_target(this.create_password.floating_input);this.create_password.floating_input.set_next_tab_target(this.create_repeat_password.floating_input);this.create_repeat_password.floating_input.set_next_tab_target(this.create_account_button);this.create_account_button.set_next_tab_target(this.login_username.floating_input);this.set_default_tab_target(this.login_username.floating_input);},update:function(){this.update_interactive_objects();},key_down_event:function(event){this.key_down_event_for_interactive_objects(event);},enter_world:function(){CURRENT_PLAYER.disengage();if(!GUI_PAUSED_MENU.currently_displayed){CURRENT_PLAYER.enable_controls();}
CURRENT_PLAYER.set_position(new THREE.Vector3(180,180,390));CURRENT_PLAYER.look_at(new THREE.Vector3(-0.011,-0.066,-0.998));if(MANAGER_COOKIES.get(COOKIE_SHOULD_REMEMBER_USERNAME)==='true'){if(MANAGER_COOKIES.get(COOKIE_REMEMBERED_USERNAME)!==undefined){if(MANAGER_COOKIES.get(COOKIE_REMEMBERED_USERNAME)!=='undefined'){this.login_username.set_input_value(MANAGER_COOKIES.get(COOKIE_REMEMBERED_USERNAME));}}}},exit_world:function(){this.login_username.floating_input.update_text('');this.login_password.floating_input.update_text('');this.create_username.floating_input.update_text('');this.create_email.floating_input.update_text('');this.create_password.floating_input.update_text('');this.create_repeat_password.floating_input.update_text('');}};function HomeWorld(){this.__init__();}
HomeWorld.prototype={entity_walls:null,loaded_entities:null,__init__:function(){World.call(this,'HomeWorld');this.loaded_entities=false;this.entity_walls=[];this.players=[];},control_key_down:null,create_entity_wall_command_entered:function(){this.create_entity_wall(CURRENT_PLAYER.get_position(),'Default');},key_down_event:function(event){this.key_down_event_for_interactive_objects(event);},create_entity_wall:function(position,wall_text,entity){var entity_wall=new EntityWall(position,this,entity);entity_wall.update_title(wall_text);if(is_defined(entity)){entity_wall.set_entity(entity);for(var ce=0;ce<entity.children.length;ce++){entity_wall.add_entity(entity.children[ce]);}}
this.entity_walls.push(entity_wall);},load_entity_walls:function(){var wall_entities=MANAGER_ENTITY.get_all_entities_of_type(ENTITY_TYPE_WALL);for(var w=0;w<wall_entities.length;w++){if(!is_defined(wall_entities[w])){GUI_PAUSED_MENU.add_server_message('Entity wall is not defined? Investigate.');l('There is non-defined entity wall being processed! Investigate!');}
var position=wall_entities[w].get_value(ENTITY_PROPERTY_POSITION);position=position.replace('[','').replace(']','');position=position.split(',');var wall_position=new THREE.Vector3(parseInt(position[0]),parseInt(position[1]),parseInt(position[2]));var title=wall_entities[w].get_value(ENTITY_PROPERTY_NAME);this.create_entity_wall(wall_position,title,wall_entities[w]);}},update:function(){if(!this.loaded_entities){if(!MANAGER_ENTITY.currently_loading()){this.load_entity_walls();this.loaded_entities=true;}}
this.update_interactive_objects();},enter_world:function(){CURRENT_PLAYER.disengage();if(!GUI_PAUSED_MENU.currently_displayed){CURRENT_PLAYER.enable_controls();}
CURRENT_PLAYER.set_position(new THREE.Vector3(0,100,0));},exit_world:function(){}};function SettingsWorld(){this.__init__();}
const CELL_PHONE_CARRIERS_AS_LIST=['No Value','AT&T','T-Mobile','Verizon','Sprint','Virgin Mobile','Tracfone','Metro PCS','Boost Mobile','Cricket','Ptel','Republic Wireless','Google Fi','Suncom','Ting','U.S. Cellular','Consumer Cellular','C-Spire','Page Plus'];SettingsWorld.prototype={previous_world:null,owner_entity:null,select_phone_carrier:function(){this.phone_carrier_list.set_to_visible();},selected_phone_carrier:function(selected_phone_carrier){this.profile_phone_carrier_input.update_text(selected_phone_carrier);this.phone_carrier_list.set_to_invisible();},save_changes_button_pressed:function(){var changes_occured=false;if(this.profile_email_input.get_text()!==this.owner_entity.get_value('owner_email')){this.owner_entity.set_property('owner_email',this.profile_email_input.get_text());changes_occured=true;}
if(this.profile_phone_number_input.get_text()!==this.owner_entity.get_value('owner_phone_number')){this.owner_entity.set_property('owner_phone_number',this.profile_phone_number_input.get_text());changes_occured=true;}
if(this.profile_phone_carrier_input.get_text()!==this.owner_entity.get_value('owner_phone_carrier')){this.owner_entity.set_property('owner_phone_carrier',this.profile_phone_carrier_input.get_text());changes_occured=true;}
if(changes_occured){MANAGER_ENTITY.update_server_and_database();}},slider_master_volume_value_changed:function(master_volume_value){l('Master volume value is now : '+master_volume_value);},slider_fov_value_changed:function(fov_value){CURRENT_PLAYER.renderer_api.camera.fov=fov_value;CURRENT_PLAYER.renderer_api.camera.updateProjectionMatrix();},__init__:function(){this.owner_entity=null;World.call(this,'SettingsWorld');var position=new THREE.Vector3(500,500,700);this.normal=new THREE.Vector3(-.5,0,-.85);this.normal.normalize();this.profile_editor=new FloatingWall(1024,512/2,position,this.normal,this);var create_entity_wall_title=this.profile_editor.add_floating_2d_text(1024/2,'Profile Information',TYPE_TITLE,1024/-4,2,0,0);create_entity_wall_title.set_default_color(COLOR_TEXT_CONSTANT);this.profile_editor.add_object_to_remove_later(create_entity_wall_title);var label_width=1024/8;var label_offset=(1024/-4)-label_width/2;var input_width=1024/2;var input_offset=1024/-4+(1024/4)+50;this.profile_name_label=this.profile_editor.add_floating_2d_text(label_width,'Username',TYPE_CONSTANT_TEXT,label_offset,2,4,0);this.profile_name_input=this.profile_editor.add_floating_2d_text(input_width,'',TYPE_CONSTANT_TEXT,input_offset,2,4,0);this.profile_email_label=this.profile_editor.add_floating_2d_text(label_width,'Email',TYPE_CONSTANT_TEXT,label_offset,2,5,0);this.profile_email_input=this.profile_editor.add_floating_2d_text(input_width,'',TYPE_INPUT_REGULAR,input_offset,2,5,0);this.profile_phone_number_label=this.profile_editor.add_floating_2d_text(label_width,'Phone Number',TYPE_CONSTANT_TEXT,label_offset,2,6,0);this.profile_phone_number_input=this.profile_editor.add_floating_2d_text(input_width,'',TYPE_INPUT_REGULAR,input_offset,2,6,0);this.profile_phone_carrier_label=this.profile_editor.add_floating_2d_text(label_width,'Phone Carrier',TYPE_CONSTANT_TEXT,label_offset,2,7,0);this.profile_phone_carrier_input=this.profile_editor.add_floating_2d_text(input_width,'',TYPE_INPUT_REGULAR,input_offset,2,7,0);this.profile_phone_carrier_input.engable=false;this.profile_created_at_date_label=this.profile_editor.add_floating_2d_text(label_width,'Created at Date',TYPE_CONSTANT_TEXT,label_offset,2,8,0);this.profile_created_at_date_input=this.profile_editor.add_floating_2d_text(input_width,'',TYPE_CONSTANT_TEXT,input_offset,2,8,0);this.profile_phone_carrier_input.set_engage_function(this.select_phone_carrier.bind(this));var phone_carrier_list_position=new THREE.Vector3(this.profile_phone_carrier_input.get_position().x+this.normal.x*8,this.profile_phone_carrier_input.get_position().y+this.normal.y*8,this.profile_phone_carrier_input.get_position().z+this.normal.z*8);this.phone_carrier_list=new FloatingWall(512/2,512,phone_carrier_list_position,this.normal,this);var phone_carrier_title=this.phone_carrier_list.add_floating_2d_text(512/2,'Select Phone Carrier',TYPE_TITLE,0,4,0,0);var current_row_index=4;for(var property in CELL_PHONE_CARRIERS){if(CELL_PHONE_CARRIERS.hasOwnProperty(property)){var current_cell_phone_carrier=this.phone_carrier_list.add_floating_2d_text(512/2,CELL_PHONE_CARRIERS_AS_LIST[current_row_index-4],TYPE_BUTTON,0,4,current_row_index,0);current_row_index+=1;this.interactive_objects.push(current_cell_phone_carrier);current_cell_phone_carrier.set_engage_function(this.selected_phone_carrier.bind(this,property));}}
this.phone_carrier_list.set_to_invisible();var slider_fov_position=new THREE.Vector3(1200,500,-350);var slider_fov_normal=new THREE.Vector3(-0.969,-0.115,-0.221);var slider_fov_width=500;this.slider_fov=new FloatingSlider('Camera FOV',90,20,160,slider_fov_width,slider_fov_position,slider_fov_normal,this);this.slider_fov.value_changed_function=this.slider_fov_value_changed.bind(this);var slider_global_audio_level_position=new THREE.Vector3(1200,750,-350);var slider_global_audio_level_normal=new THREE.Vector3(-0.969,-0.115,-0.221);var slider_global_audio_level_width=500;this.slider_global_audio_level=new FloatingSlider('Master Volume',100,0,100,slider_global_audio_level_width,slider_global_audio_level_position,slider_global_audio_level_normal,this);this.slider_global_audio_level.value_changed_function=this.slider_master_volume_value_changed.bind(this);this.interactive_objects.push(this.profile_name_label);this.interactive_objects.push(this.profile_name_input);this.interactive_objects.push(this.profile_email_label);this.interactive_objects.push(this.profile_email_input);this.interactive_objects.push(this.profile_phone_number_label);this.interactive_objects.push(this.profile_phone_number_input);this.interactive_objects.push(this.profile_phone_carrier_label);this.interactive_objects.push(this.profile_phone_carrier_input);this.interactive_objects.push(this.profile_created_at_date_label);this.interactive_objects.push(this.profile_created_at_date_input);},update:function(){this.update_interactive_objects();},key_down_event:function(event){this.key_down_event_for_interactive_objects(event);},enter_world:function(){CURRENT_PLAYER.disengage();if(!GUI_PAUSED_MENU.currently_displayed){CURRENT_PLAYER.enable_controls();}
CURRENT_PLAYER.set_position(new THREE.Vector3(-1000,350,350));CURRENT_PLAYER.look_at(new THREE.Vector3(0.992,0.124,-0.122));this.previous_world=MANAGER_WORLD.previous_world;if(this.owner_entity===null){this.owner_entity=MANAGER_ENTITY.get_owner_entity();}
this.profile_name_input.update_text(ENTITY_OWNER.get_username());this.profile_email_input.update_text(this.owner_entity.get_value(ENTITY_PROPERTY_EMAIL));this.profile_phone_number_input.update_text(this.owner_entity.get_value(ENTITY_PROPERTY_PHONE_NUMBER));this.profile_phone_carrier_input.update_text(this.owner_entity.get_value(ENTITY_PROPERTY_PHONE_CARRIER));this.profile_created_at_date_input.update_text(this.owner_entity.get_value(ENTITY_PROPERTY_CREATED_AT_DATE));},exit_world:function(){}};MANAGER_COOKIES=Cookies.noConflict();MANAGER_WORLD=new WorldManager();MANAGER_ENTITY=new EntityManager();MANAGER_MULTIPLAYER=new MultiPlayerManager();GUI_PAUSED_MENU=new PausedMenu();GUI_TYPING_INTERFACE=new TypingInterface();GLOBAL_POST_PRINT_ENTITY_MANAGER_STATUS=new GlobalPostCall(POST_URL_ENTITY_MANAGER_STATUS);var renderer_api=new RendererAPI();CURRENT_PLAYER=new Player(renderer_api);MANAGER_WORLD.set_player_and_current_world(MANAGER_WORLD.world_login);GUI_PAUSED_MENU.make_visible();MANAGER_AUDIO=new AudioManager();GUI_TYPING_INTERFACE.add_server_message('Welcome!');var previous_time=performance.now();var total_delta=0;var position_update_interval=1/20;var animate=function(){requestAnimationFrame(animate);renderer_api.pre_render();var time=performance.now();var delta=(time-previous_time)/1000.0;MANAGER_MULTIPLAYER.update(delta);CURRENT_PLAYER.update(delta);MANAGER_WORLD.update_current_scene();total_delta+=delta;if(total_delta>=position_update_interval){if(MANAGER_MULTIPLAYER.players.length>1){CURRENT_PLAYER.try_to_send_position_update_to_server();}
total_delta-=position_update_interval;}
if(GUI_TYPING_INTERFACE.needs_an_update()){GUI_TYPING_INTERFACE.update();}
renderer_api.render();renderer_api.post_render();previous_time=time;};animate();